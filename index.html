<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„Ù…ØµØ¯Ø§Ù‚ÙŠØ© Ù„ØªØ£Ø¬ÙŠØ± Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø³ÙƒÙ†ÙŠØ©</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
<script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">
<script>
tailwind.config = {
theme: {
extend: {
fontFamily: {
'cairo': ['Cairo', 'sans-serif'],
},
colors: {
'oman-blue': '#003f7f',
'oman-light': '#4a90e2',
'accent': '#22c55e',
'warning': '#f59e0b',
}
}
}
}
</script>
<style>
* {
font-family: 'Cairo', sans-serif;
}

.neumorphic {
background: #f7fafc;
box-shadow: 20px 20px 60px #d1d9e6, -20px -20px 60px #ffffff;
}

.dark .neumorphic {
background: #2d3748;
box-shadow: 20px 20px 60px #1a202c, -20px -20px 60px #4a5568;
}

.swiper-pagination-bullet {
background: #4a90e2;
}

.available-day {
background: linear-gradient(45deg, #22c55e, #16a34a);
color: white;
}

.booked-day {
background: linear-gradient(45deg, #ef4444, #dc2626);
color: white;
}

.selected-day {
background: linear-gradient(45deg, #4a90e2, #3b82f6);
color: white;
border: 2px solid #1d4ed8;
}

.fade-in {
animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(20px); }
to { opacity: 1; transform: translateY(0); }
}

@keyframes fadeOut {
from { opacity: 1; transform: translateY(0); }
to { opacity: 0; transform: translateY(-20px); }
}

/* Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙÙŠ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
.modal-container {
overflow-y: auto;
max-height: 100vh;
padding: 1rem;
}

.modal-content {
max-height: calc(100vh - 2rem);
overflow-y: auto;
}

/* Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù†ØµÙˆØµ */
.text-adaptive {
color: #374151;
}

.dark .text-adaptive {
color: #f3f4f6;
}

.text-adaptive-secondary {
color: #6b7280;
}

.dark .text-adaptive-secondary {
color: #d1d5db;
}

/* Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù…Ù†Ø²Ù„Ù‚ */
.calendar-slider {
max-height: 400px;
overflow-y: auto;
border: 2px solid #e5e7eb;
border-radius: 12px;
background: #f9fafb;
}

.dark .calendar-slider {
border-color: #374151;
background: #1f2937;
}

.calendar-day-row {
min-height: 50px;
transition: all 0.3s ease;
}

.calendar-day-row:hover {
background-color: #f3f4f6;
}

.dark .calendar-day-row:hover {
background-color: #374151;
}

/* Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ± */
.image-preview {
position: relative;
display: inline-block;
margin: 8px;
}

.image-preview img {
width: 120px;
height: 120px;
object-fit: cover;
border-radius: 12px;
border: 3px solid #e5e7eb;
transition: all 0.3s ease;
}

.image-preview:hover img {
border-color: #4a90e2;
}

.remove-image-btn {
position: absolute;
top: -10px;
right: -10px;
background: #ef4444;
color: white;
border-radius: 50%;
width: 28px;
height: 28px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
font-size: 16px;
font-weight: bold;
box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

.remove-image-btn:hover {
background: #dc2626;
}

/* ØªØ­Ø³ÙŠÙ† Ø´ÙƒÙ„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª */
.file-upload-area {
border: 3px dashed #d1d5db;
border-radius: 12px;
padding: 40px;
text-align: center;
transition: all 0.3s ease;
cursor: pointer;
}

.file-upload-area:hover {
border-color: #4a90e2;
background-color: #f8fafc;
}

.dark .file-upload-area {
border-color: #4b5563;
background-color: #1f2937;
}

.dark .file-upload-area:hover {
border-color: #4a90e2;
background-color: #374151;
}

/* Ù…Ø¤Ø´Ø± Ø­Ø§Ù„Ø© Ø§Ù„ØªØ²Ø§Ù…Ù† */
.sync-indicator {
position: fixed;
top: 20px;
left: 20px;
z-index: 1000;
display: none;
align-items: center;
gap: 8px;
padding: 8px 12px;
border-radius: 20px;
font-size: 12px;
font-weight: 500;
transition: all 0.3s ease;
}

.sync-online {
background: #10b981;
color: white;
}

.sync-offline {
background: #ef4444;
color: white;
}

.sync-syncing {
background: #f59e0b;
color: white;
}

.pulse-dot {
width: 8px;
height: 8px;
border-radius: 50%;
background: currentColor;
animation: pulse 1.5s infinite;
}

@keyframes pulse {
0%, 100% { opacity: 1; }
50% { opacity: 0.5; }
}
</style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-all duration-300">
<!-- Ù…Ø¤Ø´Ø± Ø­Ø§Ù„Ø© Ø§Ù„ØªØ²Ø§Ù…Ù† (Ù…Ø®ÙÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ†) -->
<div id="syncIndicator" class="sync-indicator sync-offline">
<div class="pulse-dot"></div>
<span id="syncStatus">ØºÙŠØ± Ù…ØªØµÙ„</span>
</div>

<!-- Header -->
<header class="bg-white dark:bg-gray-800 shadow-lg transition-all duration-300">
<div class="container mx-auto px-4 py-4">
<div class="flex justify-between items-center">
<div class="flex items-center space-x-4 space-x-reverse">
<div class="w-12 h-12 bg-gradient-to-br from-oman-blue to-oman-light rounded-lg flex items-center justify-center">
<span class="text-white font-bold text-xl">Ù…</span>
</div>
<div>
<h1 class="text-2xl font-bold text-oman-blue dark:text-oman-light">Ø§Ù„Ù…ØµØ¯Ø§Ù‚ÙŠØ©</h1>
<p class="text-sm text-adaptive-secondary">Ù„ØªØ£Ø¬ÙŠØ± Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø³ÙƒÙ†ÙŠØ©</p>
</div>
</div>

<div class="flex items-center space-x-4 space-x-reverse">
<button onclick="toggleDarkMode()" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-all duration-300">
<span id="theme-icon" class="text-xl">ğŸŒ™</span>
</button>
<button onclick="showAdminLogin()" class="px-4 py-2 bg-oman-blue hover:bg-oman-light text-white rounded-lg transition-all duration-300">
Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
</button>
</div>
</div>
</div>
</header>

<!-- Main Content -->
<main id="main-content" class="container mx-auto px-4 py-8">
<!-- Filters Section -->
<div class="neumorphic rounded-2xl p-6 mb-8 fade-in">
<h2 class="text-xl font-bold text-adaptive mb-4">Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„ØªØ±Ø©</h2>
<div class="grid grid-cols-1 md:grid-cols-4 gap-4">
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ù„Ù†ÙˆØ¹</label>
<select id="typeFilter" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
<option value="Ø´Ù‚Ø©">Ø´Ù‚Ù‚</option>
<option value="ØºØ±ÙØ©">ØºØ±Ù</option>
<option value="ÙÙŠÙ„Ø§">ÙÙ„Ù„</option>
<option value="Ø¨ÙŠØª">Ø¨ÙŠÙˆØª</option>
</select>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ù„Ø³Ø¹Ø± (Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ)</label>
<select id="priceFilter" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</option>
<option value="0-30">Ø£Ù‚Ù„ Ù…Ù† 30</option>
<option value="30-60">30 - 60</option>
<option value="60-90">60 - 90</option>
<option value="90+">90 ÙˆØ£ÙƒØ«Ø±</option>
</select>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
<select id="locationFilter" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹</option>
<option value="ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</option>
<option value="ØµÙ„Ø§Ù„Ø© Ø§Ù„ÙˆØ³Ø·Ù‰">ØµÙ„Ø§Ù„Ø© Ø§Ù„ÙˆØ³Ø·Ù‰</option>
<option value="ØµÙ„Ø§Ù„Ø© Ø§Ù„ØºØ±Ø¨ÙŠØ©">ØµÙ„Ø§Ù„Ø© Ø§Ù„ØºØ±Ø¨ÙŠØ©</option>
<option value="Ø¹ÙˆÙ‚Ø¯">Ø¹ÙˆÙ‚Ø¯</option>
<option value="Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©">Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©</option>
<option value="ØµØ­Ù†ÙˆØª">ØµØ­Ù†ÙˆØª</option>
<option value="Ø±ÙŠØ³ÙˆØª">Ø±ÙŠØ³ÙˆØª</option>
</select>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ù„Ø¨Ø­Ø«</label>
<input id="searchInput" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„ÙˆØ­Ø¯Ø© Ø£Ùˆ Ø§Ù„ÙˆØµÙ..." class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
</div>
</div>

<!-- Units Grid -->
<div id="unitsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
<!-- Units will be loaded here -->
</div>

<!-- Loading Spinner -->
<div id="loadingSpinner" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
<div class="bg-white dark:bg-gray-800 rounded-lg p-6 flex items-center space-x-4 space-x-reverse">
<div class="animate-spin rounded-full h-8 w-8 border-b-2 border-oman-blue"></div>
<span class="text-adaptive font-medium">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</span>
</div>
</div>
</main>

<!-- Admin Panel -->
<div id="adminPanel" class="hidden fixed inset-0 z-50 bg-gray-900 bg-opacity-75">
<div class="modal-container flex items-center justify-center">
<div class="modal-content bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-6xl">
<!-- Admin content will be loaded here -->
</div>
</div>
</div>

<!-- Unit Details Modal -->
<div id="unitModal" class="hidden fixed inset-0 z-40 bg-gray-900 bg-opacity-75">
<div class="modal-container flex items-center justify-center">
<div class="modal-content bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-4xl">
<!-- Unit details will be loaded here -->
</div>
</div>
</div>

<!-- Contact Modal -->
<div id="contactModal" class="hidden fixed inset-0 z-40 bg-gray-900 bg-opacity-75">
<div class="modal-container flex items-center justify-center">
<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md mx-4">
<div class="p-6">
<div class="flex justify-between items-center mb-4">
<h3 class="text-xl font-bold text-adaptive">Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©</h3>
<button onclick="closeContactModal()" class="text-adaptive-secondary hover:text-adaptive">
<span class="text-2xl">Ã—</span>
</button>
</div>
<form id="contactForm" class="space-y-4">
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ù„Ø§Ø³Ù…</label>
<input type="text" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
<input type="tel" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
<textarea required rows="4" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base"></textarea>
</div>
<button type="submit" class="w-full bg-accent hover:bg-green-600 text-white py-3 rounded-lg font-medium transition-all duration-300">
Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
</button>
</form>
</div>
</div>
</div>
</div>

<!-- Footer -->
<footer class="bg-oman-blue dark:bg-gray-800 text-white py-8 mt-16">
<div class="container mx-auto px-4">
<div class="grid grid-cols-1 md:grid-cols-3 gap-8">
<div>
<h3 class="text-xl font-bold mb-4" id="footer-company-name">Ø§Ù„Ù…ØµØ¯Ø§Ù‚ÙŠØ© Ù„ØªØ£Ø¬ÙŠØ± Ø§Ù„ÙˆØ­Ø¯Ø§Øª</h3>
<p class="text-gray-300" id="footer-description">Ù†ÙˆÙØ± Ø£ÙØ¶Ù„ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø³ÙƒÙ†ÙŠØ© Ù„Ù„Ø¥ÙŠØ¬Ø§Ø± ÙÙŠ ØµÙ„Ø§Ù„Ø© ÙˆØ¶ÙˆØ§Ø­ÙŠÙ‡Ø§ Ø¨Ø£Ø³Ø¹Ø§Ø± Ù…Ù†Ø§Ø³Ø¨Ø© ÙˆØ®Ø¯Ù…Ø© Ù…ØªÙ…ÙŠØ²Ø©.</p>
</div>
<div>
<h3 class="text-xl font-bold mb-4">Ø§Ù„ØªÙˆØ§ØµÙ„</h3>
<div class="space-y-2">
<p id="footer-whatsapp">ğŸ“± ÙˆØ§ØªØ³Ø§Ø¨: +968 9876 5432</p>
<p id="footer-phone">ğŸ“ Ù‡Ø§ØªÙ: +968 2345 6789</p>
<p id="footer-email">âœ‰ï¸ Ø§Ù„Ø¨Ø±ÙŠØ¯: info@almosdaqiya.om</p>
<p id="footer-address">ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ØµÙ„Ø§Ù„Ø©ØŒ Ø³Ù„Ø·Ù†Ø© Ø¹Ù…Ø§Ù†</p>
</div>
</div>
<div>
<h3 class="text-xl font-bold mb-4">Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©</h3>
<div class="space-y-2">
<a href="#" class="block hover:text-oman-light transition-colors">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a>
<a href="#" class="block hover:text-oman-light transition-colors">Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</a>
<a href="#" class="block hover:text-oman-light transition-colors">Ù…Ù† Ù†Ø­Ù†</a>
</div>
</div>
</div>
<div class="border-t border-gray-600 mt-8 pt-8 text-center">
<p>&copy; 2024 Ø§Ù„Ù…ØµØ¯Ø§Ù‚ÙŠØ© Ù„ØªØ£Ø¬ÙŠØ± Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø³ÙƒÙ†ÙŠØ©. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
</div>
</div>
</footer>

<script>
// ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ =====
const APP_CONFIG = {
MAX_IMAGES: 10,
MAX_FILE_SIZE: 5 * 1024 * 1024, // 5MB
CALENDAR_START: { month: 5, day: 1 }, // ÙŠÙˆÙ†ÙŠÙˆ 1
CALENDAR_END: { month: 8, day: 1 }, // Ø³Ø¨ØªÙ…Ø¨Ø± 1
ADMIN_CREDENTIALS: { username: 'AbuSalim', password: '19802002' },

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub Repository
GITHUB_CONFIG: {
owner: 'tammam2002', // ğŸ‘ˆ Ø¶Ø¹ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§
repo: 'almesdaqiya-data', // Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
branch: 'main', // Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
dataFile: 'data.json' // Ø§Ø³Ù… Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
},

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„Ø¹Ø§Ù…Ø©
SYNC_CONFIG: {
SYNC_INTERVAL: 10, // ØªØ±Ø¯Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ (Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ)
MAX_RETRIES: 3, // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª
DATA_SIGNATURE: 'ALMOSDAQIYA_RENTAL_DATA_V2'
}
};

// Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£ÙŠØ§Ù… ÙˆØ§Ù„Ø´Ù‡ÙˆØ± Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
const ARABIC_DAYS = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
const ARABIC_MONTHS = [
'ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ',
'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'
];

// ===== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ²Ø§Ù…Ù† Ù…Ø¹ GitHub Repository =====
class GitHubRepoSync {
constructor() {
// Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† APP_CONFIG
this.owner = APP_CONFIG.GITHUB_CONFIG.owner;
this.repo = APP_CONFIG.GITHUB_CONFIG.repo;
this.branch = APP_CONFIG.GITHUB_CONFIG.branch;
this.dataFile = APP_CONFIG.GITHUB_CONFIG.dataFile;

// Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
this.baseUrl = `https://api.github.com/repos/${this.owner}/${this.repo}`;
this.rawUrl = `https://raw.githubusercontent.com/${this.owner}/${this.repo}/${this.branch}/${this.dataFile}`;

console.log('ğŸ”§ ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… GitHub Repository:');
console.log('ğŸ“ Repository:', `${this.owner}/${this.repo}`);
console.log('ğŸ”— Raw URL:', this.rawUrl);
}

// ğŸ“– Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø¹Ø§Ù…Ø©ØŒ Ø¨Ø¯ÙˆÙ† token)
async fetchData() {
try {
console.log('ğŸ“¡ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub Repository...');

// Ø¥Ø¶Ø§ÙØ© timestamp Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª
const url = this.rawUrl + '?t=' + Date.now();
const response = await fetch(url, {
method: 'GET',
headers: {
'Accept': 'application/json',
'Cache-Control': 'no-cache'
}
});

if (response.ok) {
const data = await response.json();
console.log('âœ… ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­:', {
version: data.version || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
lastUpdate: data.lastUpdate || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
unitsCount: data.units?.length || 0,
messagesCount: data.messages?.length || 0
});
return data;
} else {
throw new Error(`HTTP ${response.status}: ${response.statusText}`);
}
} catch (error) {
console.warn('âŒ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub Repository:', error.message);
return null;
}
}

// ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ÙŠØ­ØªØ§Ø¬ token Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©)
async saveData(data, token) {
if (!token) {
console.warn('ğŸ”‘ ÙŠØ­ØªØ§Ø¬ Personal Access Token Ù„Ù„Ø­ÙØ¸ ÙÙŠ GitHub');
return false;
}

try {
console.log('ğŸ’¾ Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ GitHub Repository...');

// 1ï¸âƒ£ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ SHA Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ù…Ù„Ù (Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„ØªØ­Ø¯ÙŠØ«)
console.log('ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† SHA Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø­Ø§Ù„ÙŠ...');
const sha = await this.getFileSHA(token);
if (!sha) {
throw new Error('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ SHA Ø§Ù„Ù…Ù„Ù');
}
console.log('âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ SHA:', sha.substring(0, 8) + '...');

// 2ï¸âƒ£ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
const updatedData = {
...data,
signature: APP_CONFIG.SYNC_CONFIG.DATA_SIGNATURE,
lastUpdate: new Date().toISOString(),
version: this.incrementVersion(data.version),
updatedBy: 'admin_' + Date.now(),
metadata: {
...data.metadata,
lastModified: new Date().toISOString(),
source: 'GitHub Repository API'
}
};

// 3ï¸âƒ£ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ JSON Ù…Ù†Ø³Ù‚
const jsonContent = JSON.stringify(updatedData, null, 2);

// 4ï¸âƒ£ ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Base64 (Ù…Ø·Ù„ÙˆØ¨ Ù„Ù€ GitHub API)
const base64Content = btoa(unescape(encodeURIComponent(jsonContent)));

// 5ï¸âƒ£ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¥Ù„Ù‰ GitHub
console.log('ğŸ“¤ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¥Ù„Ù‰ GitHub...');
const response = await fetch(`${this.baseUrl}/contents/${this.dataFile}`, {
method: 'PUT',
headers: {
'Authorization': `Bearer ${token}`,
'Accept': 'application/vnd.github.v3+json',
'Content-Type': 'application/json',
'User-Agent': 'AlMosdaqiya-Rental-App/1.0'
},
body: JSON.stringify({
message: `ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - ${new Date().toLocaleString('ar-SA')}`,
content: base64Content,
sha: sha,
branch: this.branch,
committer: {
name: 'AlMosdaqiya Admin',
email: 'admin@almosdaqiya.local'
}
})
});

if (response.ok) {
const result = await response.json();
console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ GitHub Ø¨Ù†Ø¬Ø§Ø­!');
console.log('ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­ÙØ¸:', {
sha: result.content.sha.substring(0, 8) + '...',
size: result.content.size + ' bytes',
downloadUrl: result.content.download_url
});
return true;
} else {
const errorData = await response.json();
throw new Error(`GitHub API Error (${response.status}): ${errorData.message}`);
}

} catch (error) {
console.error('âŒ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ GitHub Repository:', error.message);
return false;
}
}

// ğŸ” Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ SHA Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ù…Ù„Ù
async getFileSHA(token) {
try {
const response = await fetch(`${this.baseUrl}/contents/${this.dataFile}`, {
method: 'GET',
headers: {
'Authorization': `Bearer ${token}`,
'Accept': 'application/vnd.github.v3+json'
}
});

if (response.ok) {
const fileData = await response.json();
return fileData.sha;
} else if (response.status === 404) {
console.log('ğŸ“„ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ØŒ Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¬Ø¯ÙŠØ¯');
return null; // Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯
} else {
console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù:', response.status, response.statusText);
return null;
}
} catch (error) {
console.warn('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ SHA Ø§Ù„Ù…Ù„Ù:', error.message);
return null;
}
}

// ğŸ“ˆ Ø²ÙŠØ§Ø¯Ø© Ø±Ù‚Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø±
incrementVersion(currentVersion) {
if (!currentVersion) return '1.0';
const version = parseFloat(currentVersion);
return (version + 0.1).toFixed(1);
}

// ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù€ Token
async validateToken(token) {
try {
const response = await fetch(`${this.baseUrl}`, {
headers: {
'Authorization': `Bearer ${token}`,
'Accept': 'application/vnd.github.v3+json'
}
});
return response.ok;
} catch (error) {
return false;
}
}
}

// ===== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… =====
class CentralSyncSystem {
constructor() {
// ğŸ”§ ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… GitHub
this.githubSync = new GitHubRepoSync();

// ğŸ“± Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
this.isOnline = navigator.onLine;
this.lastSyncTime = 0;
this.syncInterval = null;
this.retryCount = 0;
this.localBackup = {};
this.syncQueue = [];
this.isAdmin = false;
this.adminToken = null;

// ğŸ†” Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù„Ø³Ø©
this.sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

console.log('ğŸ”§ ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ù…Ø¹ GitHub Repository...');
this.init();
}

async init() {
// Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
window.addEventListener('online', () => this.handleConnectionChange(true));
window.addEventListener('offline', () => this.handleConnectionChange(false));

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€ Token Ø§Ù„Ù…Ø­ÙÙˆØ¸ (Ø¥Ù† ÙˆØ¬Ø¯)
this.loadSavedToken();

// Ø¨Ø¯Ø¡ Ø¯ÙˆØ±Ø© Ø§Ù„ØªØ²Ø§Ù…Ù†
this.startSyncCycle();

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
await this.loadInitialData();

console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Ù…Ø¹ GitHub Repository Ø¨Ù†Ø¬Ø§Ø­');
this.updateSyncIndicator('online', 'Ù…ØªØµÙ„ ÙˆÙ…ØªØ²Ø§Ù…Ù† Ù…Ø¹ GitHub');
}

// ğŸ”‘ ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù€ token Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©
setAdminToken(token) {
this.adminToken = token;
console.log('ğŸ”‘ ØªÙ… ØªØ¹ÙŠÙŠÙ† GitHub Personal Access Token Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©');

// ğŸ’¾ Ø­ÙØ¸ Ù…Ø´ÙØ± ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ ÙˆØ¢Ù…Ù†)
try {
const encryptedToken = btoa(token + '_almosdaqiya_salt');
localStorage.setItem('github_admin_token_enc', encryptedToken);
console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Token Ù…Ø´ÙØ± ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ');
} catch (error) {
console.warn('âš ï¸ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Token Ù…Ø­Ù„ÙŠØ§Ù‹:', error);
}
}

// ğŸ”“ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€ token Ø§Ù„Ù…Ø­ÙÙˆØ¸
loadSavedToken() {
try {
const encryptedToken = localStorage.getItem('github_admin_token_enc');
if (encryptedToken) {
const decryptedToken = atob(encryptedToken).replace('_almosdaqiya_salt', '');
this.adminToken = decryptedToken;
console.log('ğŸ”“ ØªÙ… ØªØ­Ù…ÙŠÙ„ GitHub Token Ø§Ù„Ù…Ø­ÙÙˆØ¸');
return true;
}
} catch (error) {
console.warn('âš ï¸ ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Token Ø§Ù„Ù…Ø­ÙÙˆØ¸:', error);
}
return false;
}

async loadInitialData() {
this.showLoadingSpinner(true);

try {
const data = await this.fetchRemoteData();
if (data) {
this.applyDataUpdate(data);
console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub Repository');
} else {
// ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
this.loadLocalBackup();
console.log('ğŸ“± ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©');
}
} catch (error) {
console.warn('âš ï¸ ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
this.loadLocalBackup();
} finally {
this.showLoadingSpinner(false);
}
}

async fetchRemoteData() {
this.updateSyncIndicator('syncing', 'Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub Repository...');

try {
const data = await this.githubSync.fetchData();

if (data && data.signature === APP_CONFIG.SYNC_CONFIG.DATA_SIGNATURE) {
this.lastSyncTime = new Date(data.lastUpdate).getTime();
this.updateSyncIndicator('online', 'ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub Ø¨Ù†Ø¬Ø§Ø­');
console.log('âœ… ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub Repository');
return data;
} else if (data) {
console.warn('âš ï¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù„Ø¨Ø© Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„ØµØ­ÙŠØ­');
this.updateSyncIndicator('offline', 'Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø© Ù…Ù† GitHub');
return null;
} else {
this.updateSyncIndicator('offline', 'ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub');
return null;
}
} catch (error) {
console.warn('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub:', error);
this.updateSyncIndicator('offline', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ GitHub');
return null;
}
}

async saveRemoteData(data) {
if (!this.isAdmin) {
console.warn('ğŸš« Ø§Ù„Ø­ÙØ¸ Ù…ØªØ§Ø­ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© ÙÙ‚Ø·');
return false;
}

if (!this.adminToken) {
this.updateSyncIndicator('offline', 'ÙŠØ­ØªØ§Ø¬ GitHub Token Ù„Ù„Ø­ÙØ¸');
console.warn('ğŸ”‘ ÙŠØ­ØªØ§Ø¬ GitHub Personal Access Token Ù„Ù„Ø­ÙØ¸');
return false;
}

this.updateSyncIndicator('syncing', 'Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ GitHub Repository...');

try {
// Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹
const dataToSave = {
...data,
signature: APP_CONFIG.SYNC_CONFIG.DATA_SIGNATURE,
lastUpdate: new Date().toISOString(),
updatedBy: this.sessionId
};

// Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ÙØ¸ ÙÙŠ GitHub
const success = await this.githubSync.saveData(dataToSave, this.adminToken);

if (success) {
this.lastSyncTime = Date.now();
this.retryCount = 0;
this.updateSyncIndicator('online', 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ GitHub Ø¨Ù†Ø¬Ø§Ø­');

// Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ø­Ù„ÙŠØ©
this.saveLocalBackup(dataToSave);

// Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†
this.broadcastUpdate();

console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ GitHub Repository Ø¨Ù†Ø¬Ø§Ø­');
return true;
} else {
throw new Error('ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ GitHub');
}

} catch (error) {
console.warn('âš ï¸ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ GitHub Repository:', error);
this.retryCount++;
this.updateSyncIndicator('offline', `ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ (${this.retryCount}/${APP_CONFIG.SYNC_CONFIG.MAX_RETRIES})`);

// Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹
this.addToSyncQueue(data);

return false;
}
}

applyDataUpdate(data) {
if (data.units) {
units = data.units;
loadUnits();
}

if (data.siteSettings) {
siteSettings = data.siteSettings;
updateFooter();
}

if (data.messages) {
messages = data.messages;
}

// Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ø­Ù„ÙŠØ©
this.saveLocalBackup(data);
}

saveLocalBackup(data) {
try {
localStorage.setItem('almosdaqiya_backup', JSON.stringify(data));
sessionStorage.setItem('almosdaqiya_backup', JSON.stringify(data));
} catch (error) {
console.warn('ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©:', error);
}
}

loadLocalBackup() {
try {
let backup = localStorage.getItem('almosdaqiya_backup');
if (!backup) {
backup = sessionStorage.getItem('almosdaqiya_backup');
}

if (backup) {
const data = JSON.parse(backup);
this.applyDataUpdate(data);
return true;
} else {
// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
this.applyDataUpdate({
units: this.getDefaultUnits(),
siteSettings: this.getDefaultSettings(),
messages: []
});
return false;
}
} catch (error) {
console.warn('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:', error);
return false;
}
}

startSyncCycle() {
// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙƒÙ„ ÙØªØ±Ø© Ù…Ø­Ø¯Ø¯Ø©
this.syncInterval = setInterval(async () => {
if (this.isOnline) {
await this.checkForUpdates();
await this.processSyncQueue();
}
}, APP_CONFIG.SYNC_CONFIG.SYNC_INTERVAL * 1000);

console.log(`â° Ø¨Ø¯Ø¡ Ø¯ÙˆØ±Ø© Ø§Ù„ØªØ²Ø§Ù…Ù† ÙƒÙ„ ${APP_CONFIG.SYNC_CONFIG.SYNC_INTERVAL} Ø«Ø§Ù†ÙŠØ©`);
}

async checkForUpdates() {
try {
const remoteData = await this.fetchRemoteData();
if (remoteData) {
const remoteUpdateTime = new Date(remoteData.lastUpdate).getTime();

if (remoteUpdateTime > this.lastSyncTime && remoteData.updatedBy !== this.sessionId) {
console.log('ğŸ”„ Ø§ÙƒØªØ´Ø§Ù ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯ Ù…Ù† GitHub');
this.applyDataUpdate(remoteData);
this.showSyncNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub', 'success');
}
}
} catch (error) {
console.warn('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª:', error);
}
}

async processSyncQueue() {
if (this.syncQueue.length === 0) return;

console.log(`ğŸ“¤ Ù…Ø¹Ø§Ù„Ø¬Ø© ${this.syncQueue.length} Ø¹Ù†ØµØ± Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ²Ø§Ù…Ù†`);

const queueCopy = [...this.syncQueue];
this.syncQueue = [];

for (const data of queueCopy) {
const success = await this.saveRemoteData(data);
if (!success) {
// Ø¥Ø¶Ø§ÙØ© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø¥Ø°Ø§ ÙØ´Ù„
this.addToSyncQueue(data);
break; // ØªÙˆÙ‚Ù Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ÙØ´Ù„
}
}
}

addToSyncQueue(data) {
// ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±
if (this.syncQueue.length < 10) { // Ø­Ø¯ Ø£Ù‚ØµÙ‰ 10 Ø¹Ù†Ø§ØµØ±
this.syncQueue.push(data);
}
}

handleConnectionChange(isOnline) {
this.isOnline = isOnline;

if (isOnline) {
console.log('ğŸŒ ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„');
this.updateSyncIndicator('syncing', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ²Ø§Ù…Ù†...');

setTimeout(async () => {
await this.checkForUpdates();
await this.processSyncQueue();
this.updateSyncIndicator('online', 'Ù…ØªØµÙ„ ÙˆÙ…ØªØ²Ø§Ù…Ù†');
}, 1000);
} else {
console.log('ğŸ“´ Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„');
this.updateSyncIndicator('offline', 'ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„');
}
}

async saveData(dataType, data) {
const fullData = {
units: units,
siteSettings: siteSettings,
messages: messages
};

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
fullData[dataType] = data;

// Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø£ÙˆÙ„Ø§Ù‹
this.saveLocalBackup(fullData);

// Ø­ÙØ¸ Ø¨Ø¹ÙŠØ¯Ø§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
if (this.isAdmin && this.isOnline) {
await this.saveRemoteData(fullData);
} else if (this.isAdmin) {
// Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
this.addToSyncQueue(fullData);
this.updateSyncIndicator('offline', 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„');
}

return true;
}

setAdminMode(isAdmin) {
this.isAdmin = isAdmin;
console.log(`ğŸ‘¤ ØªÙ… ØªØ¹ÙŠÙŠÙ† ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©: ${isAdmin ? 'Ù…ÙØ¹Ù„' : 'Ù…Ø¹Ø·Ù„'}`);
}

updateSyncIndicator(status, message) {
const indicator = document.getElementById('syncIndicator');
const statusText = document.getElementById('syncStatus');

if (indicator && statusText) {
indicator.className = `sync-indicator sync-${status}`;
statusText.textContent = message;
}
}

showLoadingSpinner(show) {
const spinner = document.getElementById('loadingSpinner');
if (spinner) {
spinner.classList.toggle('hidden', !show);
}
}

showSyncNotification(message, type = 'info') {
// Ø¹Ø¯Ù… Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ØªØ²Ø§Ù…Ù† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ†
if (!this.isAdmin) return;

const notification = document.createElement('div');
let bgColor = 'bg-blue-500';
let icon = 'â„¹ï¸';

switch(type) {
case 'success':
bgColor = 'bg-green-500';
icon = 'âœ…';
break;
case 'warning':
bgColor = 'bg-yellow-500';
icon = 'âš ï¸';
break;
case 'error':
bgColor = 'bg-red-500';
icon = 'âŒ';
break;
}

notification.className = `fixed bottom-4 right-4 ${bgColor} text-white px-4 py-2 rounded-lg shadow-lg text-sm flex items-center space-x-2 space-x-reverse z-50`;
notification.innerHTML = `
<span>${icon}</span>
<span>${message}</span>
`;

document.body.appendChild(notification);

setTimeout(() => {
notification.style.animation = 'fadeOut 0.5s ease-out forwards';
setTimeout(() => notification.remove(), 500);
}, 3000);
}

broadcastUpdate() {
// Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ Ø¨ÙˆØ¬ÙˆØ¯ ØªØ­Ø¯ÙŠØ«
try {
localStorage.setItem('almosdaqiya_last_update', Date.now().toString());
window.dispatchEvent(new CustomEvent('dataUpdated'));
} catch (error) {
console.warn('ÙØ´Ù„ ÙÙŠ Ø¨Ø« Ø§Ù„ØªØ­Ø¯ÙŠØ«:', error);
}
}

getDefaultUnits() {
return [
{
id: 1,
name: "Ø´Ù‚Ø© Ø§Ù„Ø®Ù„ÙŠØ¬ Ø§Ù„Ø±Ø§Ù‚ÙŠØ©",
type: "Ø´Ù‚Ø©",
location: "ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©",
description: "Ø´Ù‚Ø© Ù…ÙØ±ÙˆØ´Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø¹ Ø¥Ø·Ù„Ø§Ù„Ø© Ø±Ø§Ø¦Ø¹Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø±ØŒ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØºØ±ÙØªÙŠÙ† ÙˆØµØ§Ù„Ø© ÙˆÙ…Ø·Ø¨Ø® Ù…Ø¬Ù‡Ø²",
images: ["https://picsum.photos/400/300?random=1", "https://picsum.photos/400/300?random=2"],
availability: generateSampleAvailability(),
contact: { whatsapp: "+96812345678", phone: "+96812345678" }
}
];
}

getDefaultSettings() {
return {
phone: '+968 2345 6789',
whatsapp: '+968 9876 5432',
email: 'info@almosdaqiya.om',
address: 'ØµÙ„Ø§Ù„Ø©ØŒ Ø³Ù„Ø·Ù†Ø© Ø¹Ù…Ø§Ù†',
companyName: 'Ø§Ù„Ù…ØµØ¯Ø§Ù‚ÙŠØ© Ù„ØªØ£Ø¬ÙŠØ± Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø³ÙƒÙ†ÙŠØ©',
description: 'Ù†ÙˆÙØ± Ø£ÙØ¶Ù„ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø³ÙƒÙ†ÙŠØ© Ù„Ù„Ø¥ÙŠØ¬Ø§Ø± ÙÙŠ ØµÙ„Ø§Ù„Ø© ÙˆØ¶ÙˆØ§Ø­ÙŠÙ‡Ø§ Ø¨Ø£Ø³Ø¹Ø§Ø± Ù…Ù†Ø§Ø³Ø¨Ø© ÙˆØ®Ø¯Ù…Ø© Ù…ØªÙ…ÙŠØ²Ø©.'
};
}

destroy() {
if (this.syncInterval) {
clearInterval(this.syncInterval);
}
window.removeEventListener('online', this.handleConnectionChange);
window.removeEventListener('offline', this.handleConnectionChange);
console.log('ğŸ›‘ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ');
}
}

// ===== Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ =====
let syncSystem;
let siteSettings = {};
let units = [];
let messages = [];
let currentUser = null;
let selectedDates = [];
let currentUnit = null;
let currentImages = [];
let currentAvailability = {};

// ===== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ø³Ù†Ø© =====
async function saveToStorage(key, value) {
try {
// Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
if (syncSystem) {
await syncSystem.saveData(key, value);
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
switch(key) {
case 'units':
units = value;
break;
case 'siteSettings':
siteSettings = value;
break;
case 'messages':
messages = value;
break;
}

console.log(`ğŸ’¾ ØªÙ… Ø­ÙØ¸ ${key} Ø¨Ù†Ø¬Ø§Ø­`);
return true;
} catch (error) {
console.warn(`âŒ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ ${key}:`, error);
return false;
}
}

function loadFromStorage(key, defaultValue) {
// Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…
// Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ© ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ø¹Ø¨Ø± syncSystem
return defaultValue;
}

// ØªÙˆÙ„ÙŠØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆÙØ± Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
function generateSampleAvailability() {
const availability = {};
const dates = generateDateRange();

dates.forEach(dateStr => {
const isAvailable = Math.random() > 0.3; // 70% Ù…ØªØ§Ø­
const basePrice = 40 + Math.floor(Math.random() * 60); // 40-100 Ø±ÙŠØ§Ù„

availability[dateStr] = {
available: isAvailable,
price: basePrice
};
});

return availability;
}

// ØªÙˆÙ„ÙŠØ¯ Ù†Ø·Ø§Ù‚ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ù…Ù† ÙŠÙˆÙ†ÙŠÙˆ Ø¥Ù„Ù‰ Ø³Ø¨ØªÙ…Ø¨Ø±
function generateDateRange() {
const dates = [];
const currentYear = new Date().getFullYear();
const startDate = new Date(currentYear, APP_CONFIG.CALENDAR_START.month, APP_CONFIG.CALENDAR_START.day);
const endDate = new Date(currentYear, APP_CONFIG.CALENDAR_END.month, APP_CONFIG.CALENDAR_END.day);

for (let date = new Date(startDate); date <= endDate; date.setDate(date.getDate() + 1)) {
dates.push(date.toISOString().split('T')[0]);
}

return dates;
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
async function initApp() {
console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...');

// ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
syncSystem = new CentralSyncSystem();

// Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
await new Promise(resolve => {
const checkData = () => {
if (units.length > 0 || siteSettings.companyName) {
resolve();
} else {
setTimeout(checkData, 100);
}
};
checkData();
});

setupEventListeners();
initDarkMode();
updateFooter();
loadUnits();

console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­');
}

// Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
function setupEventListeners() {
document.getElementById('typeFilter').addEventListener('change', filterUnits);
document.getElementById('priceFilter').addEventListener('change', filterUnits);
document.getElementById('locationFilter').addEventListener('change', filterUnits);
document.getElementById('searchInput').addEventListener('input', filterUnits);
document.getElementById('contactForm').addEventListener('submit', handleContactSubmit);
}

// Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
function initDarkMode() {
if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
document.documentElement.classList.add('dark');
}
updateThemeIcon();

window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
document.documentElement.classList.toggle('dark', event.matches);
updateThemeIcon();
});
}

function toggleDarkMode() {
document.documentElement.classList.toggle('dark');
updateThemeIcon();
}

function updateThemeIcon() {
const icon = document.getElementById('theme-icon');
const isDark = document.documentElement.classList.contains('dark');
icon.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
}

// ØªØ­Ø¯ÙŠØ« ØªØ°ÙŠÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹
function updateFooter() {
document.getElementById('footer-company-name').textContent = siteSettings.companyName || 'Ø§Ù„Ù…ØµØ¯Ø§Ù‚ÙŠØ© Ù„ØªØ£Ø¬ÙŠØ± Ø§Ù„ÙˆØ­Ø¯Ø§Øª';
document.getElementById('footer-description').textContent = siteSettings.description || 'Ù†ÙˆÙØ± Ø£ÙØ¶Ù„ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø³ÙƒÙ†ÙŠØ© Ù„Ù„Ø¥ÙŠØ¬Ø§Ø±';
document.getElementById('footer-whatsapp').textContent = `ğŸ“± ÙˆØ§ØªØ³Ø§Ø¨: ${siteSettings.whatsapp || '+968 9876 5432'}`;
document.getElementById('footer-phone').textContent = `ğŸ“ Ù‡Ø§ØªÙ: ${siteSettings.phone || '+968 2345 6789'}`;
document.getElementById('footer-email').textContent = `âœ‰ï¸ Ø§Ù„Ø¨Ø±ÙŠØ¯: ${siteSettings.email || 'info@almosdaqiya.om'}`;
document.getElementById('footer-address').textContent = `ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${siteSettings.address || 'ØµÙ„Ø§Ù„Ø©ØŒ Ø³Ù„Ø·Ù†Ø© Ø¹Ù…Ø§Ù†'}`;
}

// ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„ÙˆØ­Ø¯Ø§Øª
function loadUnits() {
const grid = document.getElementById('unitsGrid');
grid.innerHTML = '';

if (!units || units.length === 0) {
grid.innerHTML = `
<div class="col-span-full text-center py-12">
<div class="text-6xl mb-4">ğŸ </div>
<h3 class="text-xl font-bold text-adaptive mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ­Ø¯Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
<p class="text-adaptive-secondary">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
</div>
`;
return;
}

units.forEach(unit => {
const unitCard = createUnitCard(unit);
grid.appendChild(unitCard);
});

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ù†Ø²Ù„Ù‚Ø§Øª
setTimeout(initSwipers, 100);
}

// Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙˆØ­Ø¯Ø©
function createUnitCard(unit) {
const card = document.createElement('div');
card.className = 'neumorphic rounded-2xl overflow-hidden fade-in hover:shadow-2xl transition-all duration-300';
// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ÙØ¹Ù„ÙŠØ© Ù„Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
const upcomingPrices = getUpcomingPrices(unit, 5);
const priceRange = getUnitPriceRange(unit);
const avgPrice = getUnitAveragePrice(unit);

card.innerHTML = `
<div class="relative">
<div class="swiper" id="swiper-${unit.id}">
<div class="swiper-wrapper">
${unit.images.map(img => `
<div class="swiper-slide">
<img src="${img}" alt="${unit.name}" class="w-full h-48 object-cover">
</div>
`).join('')}
</div>
<div class="swiper-pagination"></div>
<div class="swiper-button-next"></div>
<div class="swiper-button-prev"></div>
</div>
<div class="absolute top-2 right-2 bg-oman-blue text-white px-2 py-1 rounded-lg text-sm font-bold">
${unit.type}
</div>
</div>

<div class="p-4">
<h3 class="text-lg font-bold text-adaptive mb-2">${unit.name}</h3>
<p class="text-sm text-adaptive-secondary mb-2">ğŸ“ ${unit.location}</p>
<p class="text-sm text-adaptive mb-4">${unit.description}</p>

<div class="mb-4">
<h4 class="text-sm font-medium text-adaptive-secondary mb-2">Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h4>
<div class="grid grid-cols-5 gap-1">
${upcomingPrices.filter(day => day.available).slice(0, 5).map(day => {
const dateObj = new Date(day.date);
const dayName = ARABIC_DAYS[dateObj.getDay()];
return `
<div class="text-center p-1 bg-accent text-white rounded text-xs">
<div class="font-bold">${dayName.substring(0, 3)}</div>
<div>${dateObj.getDate()}</div>
<div>${day.price}Ø±.Ø¹</div>
</div>
`;
}).join('')}
</div>
</div>

<div class="flex justify-between items-center">
<div class="text-lg font-bold text-oman-blue dark:text-oman-light">
${priceRange.min === priceRange.max
? `${priceRange.min} Ø±.Ø¹/Ù„ÙŠÙ„Ø©`
: `${priceRange.min} - ${priceRange.max} Ø±.Ø¹/Ù„ÙŠÙ„Ø©`}
</div>
<div class="flex space-x-2 space-x-reverse">
<button onclick="showUnitDetails(${unit.id})" class="px-3 py-1 bg-oman-blue hover:bg-oman-light text-white rounded-lg text-sm transition-all">
Ø§Ù„ØªÙØ§ØµÙŠÙ„
</button>
<a href="https://wa.me/${unit.contact.whatsapp}?text=${encodeURIComponent('Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£ÙˆØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† ' + unit.name)}"
target="_blank"
class="px-3 py-1 bg-accent hover:bg-green-600 text-white rounded-lg text-sm transition-all inline-block text-center">
ØªÙˆØ§ØµÙ„
</a>
</div>
</div>
</div>
`;

return card;
}

// ØªÙ‡ÙŠØ¦Ø© Ù…Ù†Ø²Ù„Ù‚Ø§Øª Ø§Ù„ØµÙˆØ±
function initSwipers() {
units.forEach(unit => {
new Swiper(`#swiper-${unit.id}`, {
pagination: { el: `#swiper-${unit.id} .swiper-pagination`, clickable: true },
navigation: {
nextEl: `#swiper-${unit.id} .swiper-button-next`,
prevEl: `#swiper-${unit.id} .swiper-button-prev`
},
loop: true
});
});
}

// ØªØµÙÙŠØ© Ø§Ù„ÙˆØ­Ø¯Ø§Øª
function filterUnits() {
const filters = {
type: document.getElementById('typeFilter').value,
price: document.getElementById('priceFilter').value,
location: document.getElementById('locationFilter').value,
search: document.getElementById('searchInput').value.toLowerCase()
};

const filteredUnits = units.filter(unit => {
if (filters.type && unit.type !== filters.type) return false;
if (filters.location && unit.location !== filters.location) return false;
if (filters.search) {
const searchText = (unit.name + ' ' + unit.description).toLowerCase();
if (!searchText.includes(filters.search)) return false;
}
if (filters.price) {
const avgPrice = getUnitAveragePrice(unit);
const [min, max] = filters.price.split('-').map(p => p.replace('+', ''));
if (max && (avgPrice < parseInt(min) || avgPrice > parseInt(max))) return false;
if (!max && avgPrice < parseInt(min)) return false;
}
return true;
});

displayFilteredUnits(filteredUnits);
}

// Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©
function getUnitAveragePrice(unit) {
const prices = Object.values(unit.availability)
.filter(info => info.available)
.map(info => info.price);
return prices.length > 0 ? Math.round(prices.reduce((a, b) => a + b, 0) / prices.length) : 50;
}

// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù„Ù„ÙˆØ­Ø¯Ø©
function getUnitPriceRange(unit) {
const prices = Object.values(unit.availability)
.filter(info => info.available)
.map(info => info.price);

if (prices.length === 0) return { min: 50, max: 50 };

const min = Math.min(...prices);
const max = Math.max(...prices);

return { min, max };
}

// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ÙØ¹Ù„ÙŠØ© Ù„Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
function getUpcomingPrices(unit, count = 5) {
const today = new Date();
const dates = generateDateRange();
const upcomingDates = dates.filter(dateStr => {
const date = new Date(dateStr);
return date >= today;
}).slice(0, count);

return upcomingDates.map(dateStr => {
const dayInfo = unit.availability[dateStr];
return {
date: dateStr,
available: dayInfo ? dayInfo.available : true,
price: dayInfo ? dayInfo.price : 50
};
});
}

// Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…ØµÙØ§Ø©
function displayFilteredUnits(filteredUnits) {
const grid = document.getElementById('unitsGrid');

if (filteredUnits.length === 0) {
grid.innerHTML = `
<div class="col-span-full text-center py-12">
<div class="text-6xl mb-4">ğŸ </div>
<h3 class="text-xl font-bold text-adaptive mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ­Ø¯Ø§Øª Ù…ØªØ§Ø­Ø©</h3>
<p class="text-adaptive-secondary">Ø¬Ø±Ø¨ ØªØºÙŠÙŠØ± Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>
</div>
`;
return;
}

grid.innerHTML = '';
filteredUnits.forEach(unit => {
const unitCard = createUnitCard(unit);
grid.appendChild(unitCard);
});

setTimeout(initSwipers, 100);
}

// Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØ­Ø¯Ø©
function showUnitDetails(unitId) {
const unit = units.find(u => u.id === unitId);
if (!unit) return;

currentUnit = unit;
selectedDates = [];

const modal = document.getElementById('unitModal');
modal.querySelector('.modal-content').innerHTML = `
<div class="p-6">
<div class="flex justify-between items-start mb-6">
<div>
<h2 class="text-2xl font-bold text-adaptive">${unit.name}</h2>
<p class="text-adaptive-secondary">ğŸ“ ${unit.location} â€¢ ${unit.type}</p>
</div>
<button onclick="closeUnitModal()" class="text-adaptive-secondary hover:text-adaptive text-3xl">Ã—</button>
</div>

<div class="mb-6">
<div class="swiper" id="modal-swiper">
<div class="swiper-wrapper">
${unit.images.map(img => `
<div class="swiper-slide">
<img src="${img}" alt="${unit.name}" class="w-full h-64 md:h-96 object-cover rounded-lg">
</div>
`).join('')}
</div>
<div class="swiper-pagination"></div>
<div class="swiper-button-next"></div>
<div class="swiper-button-prev"></div>
</div>
</div>

<div class="mb-6">
<h3 class="text-lg font-bold text-adaptive mb-2">Ø§Ù„ÙˆØµÙ</h3>
<p class="text-adaptive">${unit.description}</p>
</div>

<div class="mb-6">
<h3 class="text-lg font-bold text-adaptive mb-4">Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…ØªØ§Ø­Ø© ÙˆØ£Ø³Ø¹Ø§Ø±Ù‡Ø§ (ÙŠÙˆÙ†ÙŠÙˆ - Ø³Ø¨ØªÙ…Ø¨Ø±)</h3>
<div class="calendar-slider">
${generateCalendarHTML(unit)}
</div>
<div id="selected-info" class="mt-4 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg hidden">
<h4 class="font-bold text-adaptive mb-2">Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:</h4>
<div id="selected-dates" class="text-adaptive mb-2"></div>
<div id="total-price" class="text-xl font-bold text-oman-blue dark:text-oman-light mb-3"></div>
<button onclick="confirmBooking()" class="w-full bg-accent hover:bg-green-600 text-white py-2 rounded-lg font-medium transition-all">
ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²
</button>
</div>
</div>

<div class="border-t pt-6">
<h3 class="text-lg font-bold text-adaptive mb-4">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</h3>
<div class="flex flex-wrap gap-4">
<a href="https://wa.me/${unit.contact.whatsapp}" target="_blank"
class="flex items-center space-x-2 space-x-reverse bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-all">
<span>ğŸ’¬</span><span>ÙˆØ§ØªØ³Ø§Ø¨</span>
</a>
<a href="tel:${unit.contact.phone}"
class="flex items-center space-x-2 space-x-reverse bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-all">
<span>ğŸ“</span><span>Ø§ØªØµØ§Ù„ Ù…Ø¨Ø§Ø´Ø±</span>
</a>
<button onclick="showContactModal(${unit.id})"
class="flex items-center space-x-2 space-x-reverse bg-oman-blue hover:bg-oman-light text-white px-4 py-2 rounded-lg transition-all">
<span>âœ‰ï¸</span><span>Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©</span>
</button>
</div>
</div>
</div>
`;

modal.classList.remove('hidden');

setTimeout(() => {
new Swiper('#modal-swiper', {
pagination: { el: '#modal-swiper .swiper-pagination', clickable: true },
navigation: {
nextEl: '#modal-swiper .swiper-button-next',
prevEl: '#modal-swiper .swiper-button-prev'
},
loop: true
});
}, 100);
}

// ØªÙˆÙ„ÙŠØ¯ HTML Ø§Ù„ØªÙ‚ÙˆÙŠÙ…
function generateCalendarHTML(unit) {
let html = '';
const dates = generateDateRange();
let currentMonth = -1;

dates.forEach(dateStr => {
const date = new Date(dateStr);
const monthIndex = date.getMonth();

// Ø¥Ø¶Ø§ÙØ© Ø±Ø£Ø³ Ø§Ù„Ø´Ù‡Ø±
if (monthIndex !== currentMonth) {
currentMonth = monthIndex;
html += `
<div class="bg-oman-blue text-white p-4 font-bold text-center text-lg sticky top-0 z-10">
${ARABIC_MONTHS[monthIndex]} ${date.getFullYear()}
</div>
`;
}

// Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§
const dayInfo = unit.availability[dateStr] || { available: true, price: 50 };
const dayName = ARABIC_DAYS[date.getDay()];
const isAvailable = dayInfo.available;
const price = dayInfo.price;

html += `
<div class="calendar-day-row flex items-center justify-between p-4 border-b dark:border-gray-600 transition-all duration-200 ${
isAvailable
? 'cursor-pointer hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:border-blue-300'
: 'opacity-60 bg-gray-50 dark:bg-gray-800'
}"
${isAvailable ? `onclick="selectDate('${dateStr}', ${price})"` : ''}
data-date="${dateStr}">
<div class="flex items-center space-x-4 space-x-reverse">
<div class="w-16 h-16 rounded-full bg-gradient-to-br ${
isAvailable
? 'from-accent to-green-600'
: 'from-gray-400 to-gray-500'
} flex items-center justify-center text-white font-bold">
${date.getDate()}
</div>
<div>
<div class="font-bold text-adaptive text-lg">${dayName}</div>
<div class="text-adaptive-secondary text-sm">${date.getDate()} ${ARABIC_MONTHS[monthIndex]} ${date.getFullYear()}</div>
</div>
</div>
<div class="flex items-center space-x-3 space-x-reverse">
${isAvailable
? `
<div class="text-center">
<div class="bg-accent text-white px-4 py-2 rounded-lg font-bold text-lg">${price} Ø±.Ø¹</div>
<div class="text-accent text-sm font-medium mt-1">Ù…ØªØ§Ø­ Ù„Ù„Ø­Ø¬Ø²</div>
</div>
`
: `
<div class="text-center">
<div class="bg-red-500 text-white px-4 py-2 rounded-lg font-bold">Ù…Ø­Ø¬ÙˆØ²</div>
<div class="text-red-500 text-sm font-medium mt-1">ØºÙŠØ± Ù…ØªØ§Ø­</div>
</div>
`
}
</div>
</div>
`;
});

return html;
}

// Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® Ù„Ù„Ø­Ø¬Ø²
function selectDate(dateStr, price) {
const dateElement = document.querySelector(`[data-date="${dateStr}"]`);
const existingIndex = selectedDates.findIndex(d => d.date === dateStr);

if (existingIndex !== -1) {
selectedDates.splice(existingIndex, 1);
dateElement.classList.remove('bg-blue-100', 'dark:bg-blue-800');
} else {
selectedDates.push({ date: dateStr, price: price });
dateElement.classList.add('bg-blue-100', 'dark:bg-blue-800');
}

updateSelectedInfo();
}

// ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
function updateSelectedInfo() {
const selectedInfo = document.getElementById('selected-info');
const selectedDatesDiv = document.getElementById('selected-dates');
const totalPriceDiv = document.getElementById('total-price');

if (selectedDates.length === 0) {
selectedInfo.classList.add('hidden');
return;
}

selectedInfo.classList.remove('hidden');

selectedDates.sort((a, b) => new Date(a.date) - new Date(b.date));

const datesText = selectedDates.map(d => {
const date = new Date(d.date);
const dayName = ARABIC_DAYS[date.getDay()];
const monthName = ARABIC_MONTHS[date.getMonth()];
return `${dayName} ${date.getDate()} ${monthName} (${d.price} Ø±.Ø¹)`;
}).join(' â€¢ ');

selectedDatesDiv.textContent = datesText;

const total = selectedDates.reduce((sum, d) => sum + d.price, 0);
totalPriceDiv.textContent = `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${total} Ø±.Ø¹ Ù„Ù…Ø¯Ø© ${selectedDates.length} Ù„ÙŠÙ„Ø©`;
}

// ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²
function confirmBooking() {
if (selectedDates.length === 0) return;

const total = selectedDates.reduce((sum, d) => sum + d.price, 0);
const datesText = selectedDates.map(d => {
const date = new Date(d.date);
const dayName = ARABIC_DAYS[date.getDay()];
const monthName = ARABIC_MONTHS[date.getMonth()];
return `${dayName} ${date.getDate()} ${monthName}`;
}).join(', ');

const message = `Ø£ÙˆØ¯ Ø­Ø¬Ø² ${currentUnit.name} Ù„Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„ØªØ§Ù„ÙŠØ©:\n${datesText}\nØ§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${total} Ø±.Ø¹`;
const whatsappUrl = `https://wa.me/${currentUnit.contact.whatsapp}?text=${encodeURIComponent(message)}`;

window.open(whatsappUrl, '_blank');
showNotification('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø­Ø¬Ø² Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨!', 'success');
closeUnitModal();
}

// Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØ­Ø¯Ø©
function closeUnitModal() {
document.getElementById('unitModal').classList.add('hidden');
selectedDates = [];
currentUnit = null;
}

// Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙˆØ§ØµÙ„
function showContactModal(unitId) {
const unit = units.find(u => u.id === unitId);
currentUnit = unit;
document.getElementById('contactModal').classList.remove('hidden');
}

// Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙˆØ§ØµÙ„
function closeContactModal() {
document.getElementById('contactModal').classList.add('hidden');
document.getElementById('contactForm').reset();
}

// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø±Ø³Ø§Ù„ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙˆØ§ØµÙ„
async function handleContactSubmit(event) {
event.preventDefault();
const form = event.target;

const message = {
id: Date.now(),
unitId: currentUnit.id,
unitName: currentUnit.name,
name: form.elements[0].value,
phone: form.elements[1].value,
message: form.elements[2].value,
timestamp: new Date().toISOString()
};

messages.push(message);
await saveToStorage('messages', messages);

showNotification('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­! Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.', 'success');
closeContactModal();
}

// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ±
function handleImageSelection(files) {
const fileArray = Array.from(files);

if (fileArray.length > APP_CONFIG.MAX_IMAGES) {
showNotification(`ÙŠÙ…ÙƒÙ† Ø±ÙØ¹ Ø­ØªÙ‰ ${APP_CONFIG.MAX_IMAGES} ØµÙˆØ± ÙÙ‚Ø·`, 'error');
return;
}

currentImages = [];
let processedCount = 0;

fileArray.forEach(file => {
if (file.size > APP_CONFIG.MAX_FILE_SIZE) {
showNotification(`Ø§Ù„Ù…Ù„Ù ${file.name} ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹. Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 5 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª`, 'error');
return;
}

if (!file.type.startsWith('image/')) {
showNotification(`Ø§Ù„Ù…Ù„Ù ${file.name} Ù„ÙŠØ³ ØµÙˆØ±Ø©`, 'error');
return;
}

const reader = new FileReader();
reader.onload = function(e) {
currentImages.push(e.target.result);
processedCount++;

if (processedCount === fileArray.length) {
updateImagePreview();
}
};
reader.readAsDataURL(file);
});
}

// ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±
function updateImagePreview() {
const container = document.getElementById('image-preview-container');
if (!container) return;

container.innerHTML = '';
currentImages.forEach((src, index) => {
const div = document.createElement('div');
div.className = 'image-preview';
div.innerHTML = `
<img src="${src}" alt="ØµÙˆØ±Ø© ${index + 1}">
<div class="remove-image-btn" onclick="removeImage(${index})">Ã—</div>
`;
container.appendChild(div);
});
}

// Ø­Ø°Ù ØµÙˆØ±Ø©
function removeImage(index) {
currentImages.splice(index, 1);
updateImagePreview();
}

// Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ø­Ø³Ù†Ø©
function generatePricingInterface() {
return `
<div class="space-y-6">
<!-- Ø£Ø¯ÙˆØ§Øª ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
<div class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 p-6 rounded-xl border border-blue-200 dark:border-blue-700">
<h3 class="text-lg font-bold text-adaptive mb-4 flex items-center">
<span class="text-2xl ml-2">ğŸ’°</span>
Ø£Ø¯ÙˆØ§Øª ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
</h3>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<!-- ØªØ­Ø¯ÙŠØ¯ Ø³Ø¹Ø± Ù…ÙˆØ­Ø¯ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙŠØ§Ù… -->
<div class="bg-white dark:bg-gray-700 p-4 rounded-lg border">
<h4 class="font-bold text-adaptive mb-3">Ø³Ø¹Ø± Ù…ÙˆØ­Ø¯ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙŠØ§Ù…</h4>
<div class="flex space-x-3 space-x-reverse">
<input type="number" id="uniformPrice" min="1" placeholder="50"
class="flex-1 p-3 border rounded-lg bg-white dark:bg-gray-600 text-adaptive text-base">
<button onclick="applyUniformPrice()"
class="px-4 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-all whitespace-nowrap">
ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„
</button>
</div>
</div>

<!-- ØªØ­Ø¯ÙŠØ¯ Ø£Ø³Ø¹Ø§Ø± Ø­Ø³Ø¨ Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ -->
<div class="bg-white dark:bg-gray-700 p-4 rounded-lg border">
<h4 class="font-bold text-adaptive mb-3">Ø£Ø³Ø¹Ø§Ø± Ø­Ø³Ø¨ Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</h4>
<div class="grid grid-cols-2 gap-2 mb-3">
<input type="number" id="weekdayPrice" min="1" placeholder="Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹"
class="p-2 border rounded text-center text-sm bg-white dark:bg-gray-600 text-adaptive">
<input type="number" id="weekendPrice" min="1" placeholder="Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹"
class="p-2 border rounded text-center text-sm bg-white dark:bg-gray-600 text-adaptive">
</div>
<button onclick="applyWeeklyPricing()"
class="w-full px-3 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-all text-sm">
ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©
</button>
</div>
</div>

<!-- ØªØ­Ø¯ÙŠØ¯ Ø£Ø³Ø¹Ø§Ø± Ù„Ù†Ø·Ø§Ù‚ ØªÙˆØ§Ø±ÙŠØ® Ù…Ø­Ø¯Ø¯ -->
<div class="mt-4 bg-white dark:bg-gray-700 p-4 rounded-lg border">
<h4 class="font-bold text-adaptive mb-3">ØªØ­Ø¯ÙŠØ¯ Ø³Ø¹Ø± Ù„Ù†Ø·Ø§Ù‚ ØªÙˆØ§Ø±ÙŠØ® Ù…Ø­Ø¯Ø¯</h4>
<div class="grid grid-cols-1 md:grid-cols-4 gap-3">
<input type="date" id="startDate"
class="p-3 border rounded-lg bg-white dark:bg-gray-600 text-adaptive text-base">
<input type="date" id="endDate"
class="p-3 border rounded-lg bg-white dark:bg-gray-600 text-adaptive text-base">
<input type="number" id="rangePrice" min="1" placeholder="Ø§Ù„Ø³Ø¹Ø±"
class="p-3 border rounded-lg bg-white dark:bg-gray-600 text-adaptive text-base">
<button onclick="applyRangePrice()"
class="px-4 py-3 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-all">
ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø·Ø§Ù‚
</button>
</div>
</div>

<!-- Ø£Ø²Ø±Ø§Ø± Ø³Ø±ÙŠØ¹Ø© Ù„Ø£Ø³Ø¹Ø§Ø± Ø´Ø§Ø¦Ø¹Ø© -->
<div class="mt-4">
<h4 class="font-bold text-adaptive mb-3">Ø£Ø³Ø¹Ø§Ø± Ø³Ø±ÙŠØ¹Ø© Ø´Ø§Ø¦Ø¹Ø©</h4>
<div class="flex flex-wrap gap-2">
${[30, 40, 50, 60, 70, 80, 90, 100].map(price => `
<button onclick="applyUniformPriceValue(${price})"
class="px-3 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-adaptive rounded-lg text-sm transition-all">
${price} Ø±.Ø¹
</button>
`).join('')}
</div>
</div>
</div>

<!-- Ù…Ø¹Ø§ÙŠÙ†Ø© ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± -->
<div class="bg-white dark:bg-gray-700 rounded-lg border">
<div class="p-4 border-b dark:border-gray-600">
<h3 class="text-lg font-bold text-adaptive flex items-center">
<span class="text-2xl ml-2">ğŸ“…</span>
Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ØªÙˆÙØ± ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
</h3>
</div>
<div class="calendar-slider">
${generateDetailedAvailabilityAdmin()}
</div>
</div>

<!-- Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± -->
<div id="pricingSummary" class="bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 p-4 rounded-lg border border-green-200 dark:border-green-700">
${generatePricingSummary()}
</div>
</div>
`;
}

// Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
function generateDetailedAvailabilityAdmin() {
let html = '';
const dates = generateDateRange();
let currentMonth = -1;

dates.forEach(dateStr => {
const date = new Date(dateStr);
const monthIndex = date.getMonth();

if (monthIndex !== currentMonth) {
currentMonth = monthIndex;
html += `
<div class="bg-oman-blue text-white p-3 font-bold text-center sticky top-0 z-10">
${ARABIC_MONTHS[monthIndex]} ${date.getFullYear()}
</div>
`;
}

const dayName = ARABIC_DAYS[date.getDay()];
const existingData = currentAvailability[dateStr] || { available: true, price: 50 };
const isWeekend = date.getDay() === 5 || date.getDay() === 6; // Ø¬Ù…Ø¹Ø© ÙˆØ³Ø¨Øª

html += `
<div class="calendar-day-row flex items-center justify-between p-3 border-b dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600">
<div class="flex items-center space-x-3 space-x-reverse">
<div class="w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm ${
isWeekend ? 'bg-purple-500' : 'bg-blue-500'
}">
${date.getDate()}
</div>
<div>
<span class="font-medium text-adaptive">${dayName}</span>
<div class="text-xs text-adaptive-secondary">${ARABIC_MONTHS[monthIndex]}</div>
</div>
</div>
<div class="flex items-center space-x-3 space-x-reverse">
<label class="flex items-center">
<input type="checkbox" ${existingData.available ? 'checked' : ''}
onchange="updateAvailability('${dateStr}', 'available', this.checked)"
class="ml-2 w-4 h-4">
<span class="text-sm text-adaptive-secondary">Ù…ØªØ§Ø­</span>
</label>
<div class="flex items-center space-x-1 space-x-reverse">
<input type="number"
value="${existingData.price}"
min="1"
onchange="updateAvailability('${dateStr}', 'price', parseInt(this.value))"
class="w-16 p-2 border rounded text-center text-sm bg-white dark:bg-gray-600 dark:border-gray-500 text-adaptive">
<span class="text-xs text-adaptive-secondary">Ø±.Ø¹</span>
</div>
</div>
</div>
`;
});

return html;
}

// ØªØ·Ø¨ÙŠÙ‚ Ø³Ø¹Ø± Ù…ÙˆØ­Ø¯
function applyUniformPrice() {
const price = parseInt(document.getElementById('uniformPrice').value);
if (!price || price < 1) {
showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± ØµØ­ÙŠØ­', 'error');
return;
}
applyUniformPriceValue(price);
}

function applyUniformPriceValue(price) {
const dates = generateDateRange();
dates.forEach(dateStr => {
updateAvailability(dateStr, 'price', price);
updateAvailability(dateStr, 'available', true);
});

// ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
refreshPricingInterface();
showNotification(`ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø³Ø¹Ø± ${price} Ø±.Ø¹ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙŠØ§Ù…`, 'success');
}

// ØªØ·Ø¨ÙŠÙ‚ Ø£Ø³Ø¹Ø§Ø± Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ÙˆÙ†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
function applyWeeklyPricing() {
const weekdayPrice = parseInt(document.getElementById('weekdayPrice').value);
const weekendPrice = parseInt(document.getElementById('weekendPrice').value);

if (!weekdayPrice || !weekendPrice || weekdayPrice < 1 || weekendPrice < 1) {
showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø³Ø¹Ø§Ø± ØµØ­ÙŠØ­Ø© Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ÙˆÙ†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹', 'error');
return;
}

const dates = generateDateRange();
dates.forEach(dateStr => {
const date = new Date(dateStr);
const dayOfWeek = date.getDay();
const isWeekend = dayOfWeek === 5 || dayOfWeek === 6; // Ø¬Ù…Ø¹Ø© ÙˆØ³Ø¨Øª

const price = isWeekend ? weekendPrice : weekdayPrice;
updateAvailability(dateStr, 'price', price);
updateAvailability(dateStr, 'available', true);
});

refreshPricingInterface();
showNotification(`ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹: ${weekdayPrice} Ø±.Ø¹ Ù„Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©ØŒ ${weekendPrice} Ø±.Ø¹ Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹`, 'success');
}

// ØªØ·Ø¨ÙŠÙ‚ Ø³Ø¹Ø± Ø¹Ù„Ù‰ Ù†Ø·Ø§Ù‚ ØªÙˆØ§Ø±ÙŠØ®
function applyRangePrice() {
const startDate = document.getElementById('startDate').value;
const endDate = document.getElementById('endDate').value;
const price = parseInt(document.getElementById('rangePrice').value);

if (!startDate || !endDate || !price || price < 1) {
showNotification('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ© ÙˆØ§Ù„Ø³Ø¹Ø±', 'error');
return;
}

const start = new Date(startDate);
const end = new Date(endDate);

if (start > end) {
showNotification('ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‚Ø¨Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©', 'error');
return;
}

let count = 0;
const currentDate = new Date(start);

while (currentDate <= end) {
const dateStr = currentDate.toISOString().split('T')[0];
if (currentAvailability[dateStr] !== undefined) {
updateAvailability(dateStr, 'price', price);
updateAvailability(dateStr, 'available', true);
count++;
}
currentDate.setDate(currentDate.getDate() + 1);
}

refreshPricingInterface();
showNotification(`ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø³Ø¹Ø± ${price} Ø±.Ø¹ Ø¹Ù„Ù‰ ${count} ÙŠÙˆÙ…`, 'success');
}

// ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
function refreshPricingInterface() {
// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
const container = document.querySelector('.calendar-slider');
if (container) {
container.innerHTML = generateDetailedAvailabilityAdmin();
}

// ØªØ­Ø¯ÙŠØ« Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
const summaryContainer = document.getElementById('pricingSummary');
if (summaryContainer) {
summaryContainer.innerHTML = generatePricingSummary();
}
}

// Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
function generatePricingSummary() {
const dates = generateDateRange();
const availableDates = dates.filter(dateStr => {
const dayInfo = currentAvailability[dateStr];
return dayInfo && dayInfo.available;
});

if (availableDates.length === 0) {
return `
<h3 class="text-lg font-bold text-adaptive mb-2">ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</h3>
<p class="text-adaptive-secondary">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙŠØ§Ù… Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
`;
}

const prices = availableDates.map(dateStr => currentAvailability[dateStr].price);
const minPrice = Math.min(...prices);
const maxPrice = Math.max(...prices);
const avgPrice = Math.round(prices.reduce((a, b) => a + b, 0) / prices.length);

// ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
const priceGroups = {};
prices.forEach(price => {
priceGroups[price] = (priceGroups[price] || 0) + 1;
});

return `
<h3 class="text-lg font-bold text-adaptive mb-3 flex items-center">
<span class="text-2xl ml-2">ğŸ“Š</span>
Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
</h3>
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
<div class="text-center">
<div class="text-2xl font-bold text-green-600">${availableDates.length}</div>
<div class="text-sm text-adaptive-secondary">ÙŠÙˆÙ… Ù…ØªØ§Ø­</div>
</div>
<div class="text-center">
<div class="text-2xl font-bold text-blue-600">${minPrice} Ø±.Ø¹</div>
<div class="text-sm text-adaptive-secondary">Ø£Ù‚Ù„ Ø³Ø¹Ø±</div>
</div>
<div class="text-center">
<div class="text-2xl font-bold text-purple-600">${maxPrice} Ø±.Ø¹</div>
<div class="text-sm text-adaptive-secondary">Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø±</div>
</div>
<div class="text-center">
<div class="text-2xl font-bold text-orange-600">${avgPrice} Ø±.Ø¹</div>
<div class="text-sm text-adaptive-secondary">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø¹Ø±</div>
</div>
</div>
<div class="text-sm text-adaptive-secondary">
<strong>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:</strong>
${Object.entries(priceGroups)
.sort((a, b) => parseInt(a[0]) - parseInt(b[0]))
.map(([price, count]) => `${price} Ø±.Ø¹ (${count} ÙŠÙˆÙ…)`)
.join(' â€¢ ')}
</div>
`;
}

// ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆÙØ±
function updateAvailability(dateStr, field, value) {
if (!currentAvailability[dateStr]) {
currentAvailability[dateStr] = { available: true, price: 50 };
}
currentAvailability[dateStr][field] = value;
}

// Ø¥Ø¯Ø§Ø±Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
function showAdminLogin() {
const adminPanel = document.getElementById('adminPanel');
adminPanel.querySelector('.modal-content').innerHTML = `
<div class="p-8">
<div class="text-center mb-8">
<div class="w-16 h-16 bg-gradient-to-br from-oman-blue to-oman-light rounded-full flex items-center justify-center mx-auto mb-4">
<span class="text-white font-bold text-2xl">ğŸ”</span>
</div>
<h2 class="text-2xl font-bold text-adaptive">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
</div>

<form onsubmit="handleAdminLogin(event)" class="space-y-6">
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
<input type="text" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
<input type="password" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<button type="submit" class="w-full bg-oman-blue hover:bg-oman-light text-white py-3 rounded-lg font-medium transition-all">
Ø¯Ø®ÙˆÙ„
</button>
<button type="button" onclick="closeAdminPanel()" class="w-full bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg font-medium transition-all">
Ø¥Ù„ØºØ§Ø¡
</button>
</form>
</div>
`;
adminPanel.classList.remove('hidden');
}

// Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
function handleAdminLogin(event) {
event.preventDefault();
const form = event.target;
const username = form.elements[0].value;
const password = form.elements[1].value;

if (username === APP_CONFIG.ADMIN_CREDENTIALS.username && password === APP_CONFIG.ADMIN_CREDENTIALS.password) {
currentUser = { username: 'admin', role: 'admin' };

// ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ²Ø§Ù…Ù†
if (syncSystem) {
syncSystem.setAdminMode(true);
// Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ²Ø§Ù…Ù† Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© ÙÙ‚Ø·
const indicator = document.getElementById('syncIndicator');
indicator.style.display = 'flex';
}

showAdminDashboard();
} else {
showNotification('Ø¨ÙŠØ§Ù†Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
}
}

// Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
function showAdminDashboard() {
const adminPanel = document.getElementById('adminPanel');
adminPanel.querySelector('.modal-content').innerHTML = `
<div class="bg-gradient-to-r from-oman-blue to-oman-light text-white p-6 rounded-t-2xl">
<div class="flex justify-between items-center">
<div>
<h1 class="text-2xl font-bold">Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ¯Ø§Ù‚ÙŠØ©</h1>
<p class="text-blue-100">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ ${currentUser.username} â€¢ ${syncSystem && syncSystem.isOnline ? 'ğŸŸ¢ Ù…ØªØµÙ„' : 'ğŸ”´ ØºÙŠØ± Ù…ØªØµÙ„'}</p>
</div>
<button onclick="closeAdminPanel()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all">
Ø®Ø±ÙˆØ¬
</button>
</div>
</div>

<div class="border-b dark:border-gray-700">
<nav class="flex space-x-8 space-x-reverse px-6">
<button onclick="showAdminTab('units')" class="admin-tab-btn active px-4 py-3 font-medium border-b-2 border-oman-blue text-oman-blue">
Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ­Ø¯Ø§Øª
</button>
<button onclick="showAdminTab('messages')" class="admin-tab-btn px-4 py-3 font-medium border-b-2 border-transparent text-adaptive-secondary hover:text-adaptive">
Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (${messages.length})
</button>
<button onclick="showAdminTab('settings')" class="admin-tab-btn px-4 py-3 font-medium border-b-2 border-transparent text-adaptive-secondary hover:text-adaptive">
Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹
</button>
<button onclick="showAdminTab('sync')" class="admin-tab-btn px-4 py-3 font-medium border-b-2 border-transparent text-adaptive-secondary hover:text-adaptive">
ğŸ”„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ²Ø§Ù…Ù†
</button>
</nav>
</div>

<div id="admin-content" class="p-6">
${getAdminUnitsContent()}
</div>
`;
}

// Ø¹Ø±Ø¶ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
function showAdminTab(tab) {
document.querySelectorAll('.admin-tab-btn').forEach(btn => {
btn.classList.remove('active', 'border-oman-blue', 'text-oman-blue');
btn.classList.add('border-transparent', 'text-adaptive-secondary');
});

event.target.classList.add('active', 'border-oman-blue', 'text-oman-blue');
event.target.classList.remove('border-transparent', 'text-adaptive-secondary');

const content = document.getElementById('admin-content');
switch(tab) {
case 'units':
content.innerHTML = getAdminUnitsContent();
break;
case 'messages':
content.innerHTML = getAdminMessagesContent();
break;
case 'settings':
content.innerHTML = getAdminSettingsContent();
break;
case 'sync':
content.innerHTML = getAdminSyncContent();
break;
}
}

// Ù…Ø­ØªÙˆÙ‰ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ­Ø¯Ø§Øª
function getAdminUnitsContent() {
return `
<div class="mb-6">
<div class="flex justify-between items-center">
<h2 class="text-xl font-bold text-adaptive">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ­Ø¯Ø§Øª</h2>
<button onclick="showAddUnitForm()" class="bg-accent hover:bg-green-600 text-white px-6 py-2 rounded-lg font-medium transition-all">
+ Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©
</button>
</div>
</div>

<div class="overflow-x-auto">
<table class="w-full bg-white dark:bg-gray-700 rounded-lg shadow">
<thead class="bg-gray-50 dark:bg-gray-800">
<tr>
<th class="px-6 py-3 text-right text-xs font-medium text-adaptive-secondary uppercase">Ø§Ù„ÙˆØ­Ø¯Ø©</th>
<th class="px-6 py-3 text-right text-xs font-medium text-adaptive-secondary uppercase">Ø§Ù„Ù†ÙˆØ¹</th>
<th class="px-6 py-3 text-right text-xs font-medium text-adaptive-secondary uppercase">Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
<th class="px-6 py-3 text-right text-xs font-medium text-adaptive-secondary uppercase">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø¹Ø±</th>
<th class="px-6 py-3 text-right text-xs font-medium text-adaptive-secondary uppercase">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody class="divide-y divide-gray-200 dark:divide-gray-600">
${units.map(unit => `
<tr class="hover:bg-gray-50 dark:hover:bg-gray-600">
<td class="px-6 py-4">
<div class="flex items-center">
<img src="${unit.images[0]}" alt="${unit.name}" class="w-12 h-12 rounded-lg object-cover ml-4">
<div class="text-sm font-medium text-adaptive">${unit.name}</div>
</div>
</td>
<td class="px-6 py-4 text-sm text-adaptive">${unit.type}</td>
<td class="px-6 py-4 text-sm text-adaptive">${unit.location}</td>
<td class="px-6 py-4 text-sm text-adaptive">${getUnitAveragePrice(unit)} Ø±.Ø¹</td>
<td class="px-6 py-4 text-sm font-medium">
<div class="flex space-x-2 space-x-reverse">
<button onclick="editUnit(${unit.id})" class="text-oman-blue hover:text-oman-light">ØªØ¹Ø¯ÙŠÙ„</button>
<button onclick="deleteUnit(${unit.id})" class="text-red-600 hover:text-red-900">Ø­Ø°Ù</button>
</div>
</td>
</tr>
`).join('')}
</tbody>
</table>
</div>
`;
}

// Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
function getAdminMessagesContent() {
return `
<div class="mb-6">
<h2 class="text-xl font-bold text-adaptive">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h2>
</div>

${messages.length === 0 ? `
<div class="text-center py-12">
<div class="text-6xl mb-4">ğŸ“¬</div>
<h3 class="text-xl font-bold text-adaptive mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„</h3>
<p class="text-adaptive-secondary">Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù‡Ù†Ø§</p>
</div>
` : `
<div class="space-y-4">
${messages.map(message => `
<div class="bg-white dark:bg-gray-700 rounded-lg shadow p-6">
<div class="flex justify-between items-start mb-4">
<div>
<h3 class="text-lg font-bold text-adaptive">${message.name}</h3>
<p class="text-sm text-adaptive-secondary">ğŸ“ ${message.phone}</p>
<p class="text-sm text-adaptive-secondary">ğŸ  ${message.unitName}</p>
</div>
<div class="text-sm text-adaptive-secondary">
${new Date(message.timestamp).toLocaleDateString('ar-SA')}
</div>
</div>
<div class="bg-gray-50 dark:bg-gray-600 rounded-lg p-4 mb-4">
<p class="text-adaptive">${message.message}</p>
</div>
<div class="flex space-x-4 space-x-reverse">
<a href="tel:${message.phone}" class="text-oman-blue hover:text-oman-light">Ø§ØªØµØ§Ù„</a>
<a href="https://wa.me/${message.phone}" target="_blank" class="text-green-600 hover:text-green-700">ÙˆØ§ØªØ³Ø§Ø¨</a>
</div>
</div>
`).join('')}
</div>
`}
`;
}

// Ù…Ø­ØªÙˆÙ‰ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹
function getAdminSettingsContent() {
return `
<div class="mb-6">
<h2 class="text-xl font-bold text-adaptive">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</h2>
<p class="text-adaptive-secondary">ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©</p>
</div>

<form onsubmit="handleSaveSettings(event)" class="space-y-6">
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©</label>
<input type="text" value="${siteSettings.companyName || ''}" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
<input type="text" value="${siteSettings.address || ''}" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
<input type="tel" value="${siteSettings.phone || ''}" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨</label>
<input type="tel" value="${siteSettings.whatsapp || ''}" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div class="md:col-span-2">
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
<input type="email" value="${siteSettings.email || ''}" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">ÙˆØµÙ Ø§Ù„Ø´Ø±ÙƒØ©</label>
<textarea required rows="4" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">${siteSettings.description || ''}</textarea>
</div>

<div class="flex space-x-4 space-x-reverse">
<button type="submit" class="bg-oman-blue hover:bg-oman-light text-white px-6 py-3 rounded-lg font-medium transition-all">
Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
</button>
</div>
</form>
`;
}

// Ù…Ø­ØªÙˆÙ‰ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ²Ø§Ù…Ù† Ù…Ø¹ GitHub Repository
function getAdminSyncContent() {
const hasToken = syncSystem && syncSystem.adminToken;
const config = APP_CONFIG.GITHUB_CONFIG;

return `
<div class="mb-6">
<h2 class="text-xl font-bold text-adaptive">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ²Ø§Ù…Ù† Ù…Ø¹ GitHub Repository</h2>
<p class="text-adaptive-secondary">ØªØ²Ø§Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ GitHub Repository Ø¨Ø´ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø±</p>
</div>

<!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Repository -->
<div class="mb-6 p-4 bg-gradient-to-r from-gray-50 to-blue-50 dark:from-gray-800 dark:to-blue-900/20 border border-gray-200 dark:border-gray-700 rounded-lg">
<h3 class="text-lg font-bold text-adaptive mb-3 flex items-center">
<span class="text-2xl ml-2">ğŸ“</span>
Ù…Ø¹Ù„ÙˆÙ…Ø§Øª GitHub Repository
</h3>
<div class="grid grid-cols-2 gap-4 text-sm">
<div>
<span class="text-adaptive-secondary">Ø§Ù„Ù…Ø§Ù„Ùƒ:</span>
<span class="font-mono text-adaptive font-bold">${config.owner}</span>
</div>
<div>
<span class="text-adaptive-secondary">Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹:</span>
<span class="font-mono text-adaptive font-bold">${config.repo}</span>
</div>
<div>
<span class="text-adaptive-secondary">Ø§Ù„ÙØ±Ø¹:</span>
<span class="font-mono text-adaptive font-bold">${config.branch}</span>
</div>
<div>
<span class="text-adaptive-secondary">Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</span>
<span class="font-mono text-adaptive font-bold">${config.dataFile}</span>
</div>
</div>
<div class="mt-3 p-3 bg-white dark:bg-gray-700 rounded border-l-4 border-blue-500">
<div class="text-xs text-adaptive-secondary">ğŸ“¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±:</div>
<div class="font-mono text-xs text-blue-600 break-all">
https://raw.githubusercontent.com/${config.owner}/${config.repo}/${config.branch}/${config.dataFile}
</div>
</div>
</div>

<!-- Ø¥Ø¹Ø¯Ø§Ø¯ GitHub Token -->
<div class="mb-6 p-6 ${hasToken ? 'bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-700' : 'bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-700'} border rounded-xl">
<h3 class="text-lg font-bold text-adaptive mb-4 flex items-center">
<span class="text-2xl ml-2">${hasToken ? 'âœ…' : 'ğŸ”‘'}</span>
GitHub Personal Access Token
</h3>

${hasToken ? `
<div class="mb-4 p-3 bg-green-100 dark:bg-green-800/30 border border-green-300 dark:border-green-600 rounded text-green-800 dark:text-green-200 text-sm">
âœ… ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ GitHub Token Ø¨Ù†Ø¬Ø§Ø­ - ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Repository
</div>
` : `
<div class="mb-4 p-3 bg-yellow-100 dark:bg-yellow-800/30 border border-yellow-300 dark:border-yellow-600 rounded text-yellow-800 dark:text-yellow-200 text-sm">
âš ï¸ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ GitHub Personal Access Token Ù„Ù„Ø­ÙØ¸ ÙÙŠ Repository
</div>
`}

<div class="space-y-4">
<div class="flex space-x-3 space-x-reverse">
<input type="password"
id="githubToken"
placeholder="ghp_xxxxxxxxxxxxxxxxxxxx"
class="flex-1 p-3 border rounded-lg bg-white dark:bg-gray-600 dark:border-gray-500 text-adaptive text-base font-mono">
<button onclick="setGitHubToken()"
class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-all whitespace-nowrap">
${hasToken ? 'ğŸ”„ ØªØ­Ø¯ÙŠØ« Token' : 'ğŸ’¾ Ø­ÙØ¸ Token'}
</button>
</div>
<div id="tokenStatus" class="text-sm"></div>

<details class="mt-4">
<summary class="cursor-pointer text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 font-medium">
ğŸ“– ÙƒÙŠÙÙŠØ© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ GitHub Personal Access Token
</summary>
<div class="mt-3 p-4 bg-gray-50 dark:bg-gray-700 rounded border text-sm text-adaptive space-y-2">
<h4 class="font-bold">Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Token:</h4>
<ol class="list-decimal list-inside space-y-1 text-adaptive-secondary">
<li>Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ <a href="https://github.com/settings/tokens" target="_blank" class="text-blue-600 hover:underline">GitHub.com â†’ Settings â†’ Developer settings</a></li>
<li>Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "Personal access tokens" â†’ "Tokens (classic)"</li>
<li>Ø§Ù†Ù‚Ø± "Generate new token" â†’ "Generate new token (classic)"</li>
<li>Ø£Ø¹Ø· Ø§Ù„Ù€ Token Ø§Ø³Ù…: <code class="bg-gray-200 dark:bg-gray-600 px-1 rounded">AlMosdaqiya Admin Token</code></li>
<li>Ø§Ø®ØªØ± ØµÙ„Ø§Ø­ÙŠØ© <strong>"repo"</strong> (Full control of private repositories)</li>
<li>Ø§Ù†Ù‚Ø± "Generate token" ÙˆØ§Ù†Ø³Ø® Ø§Ù„Ù€ Token ÙÙˆØ±Ø§Ù‹</li>
<li>Ø§Ù„ØµÙ‚ Ø§Ù„Ù€ Token Ù‡Ù†Ø§ ÙˆØ§Ø­ÙØ¸Ù‡</li>
</ol>
<div class="mt-3 p-2 bg-yellow-100 dark:bg-yellow-800/30 border border-yellow-300 dark:border-yellow-600 rounded text-yellow-800 dark:text-yellow-200 text-xs">
âš ï¸ <strong>Ù…Ù‡Ù…:</strong> Ø§Ø­ÙØ¸ Ø§Ù„Ù€ Token ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ù…Ù†ØŒ Ù„Ù† ØªØªÙ…ÙƒÙ† Ù…Ù† Ø±Ø¤ÙŠØªÙ‡ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ÙÙŠ GitHub
</div>
</div>
</details>
</div>
</div>

<!-- Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ²Ø§Ù…Ù† -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
<!-- Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… -->
<div class="bg-white dark:bg-gray-700 rounded-lg shadow-lg p-6">
<h3 class="text-lg font-bold text-adaptive mb-4 flex items-center">
<span class="text-2xl ml-2">ğŸ“Š</span>
Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
</h3>
<div class="space-y-3">
<div class="flex justify-between items-center">
<span class="text-adaptive-secondary">GitHub Token:</span>
<span class="font-bold ${hasToken ? 'text-green-600' : 'text-red-600'}">
${hasToken ? 'ğŸŸ¢ Ù…ÙØ¹Ø¯Ù‘' : 'ğŸ”´ ØºÙŠØ± Ù…ÙØ¹Ø¯Ù‘'}
</span>
</div>
<div class="flex justify-between items-center">
<span class="text-adaptive-secondary">Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„:</span>
<span class="font-bold ${syncSystem && syncSystem.isOnline ? 'text-green-600' : 'text-red-600'}">
${syncSystem && syncSystem.isOnline ? 'ğŸŸ¢ Ù…ØªØµÙ„' : 'ğŸ”´ ØºÙŠØ± Ù…ØªØµÙ„'}
</span>
</div>
<div class="flex justify-between items-center">
<span class="text-adaptive-secondary">Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª:</span>
<span class="font-bold text-adaptive">${units.length}</span>
</div>
<div class="flex justify-between items-center">
<span class="text-adaptive-secondary">Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„:</span>
<span class="font-bold text-adaptive">${messages.length}</span>
</div>
<div class="flex justify-between items-center">
<span class="text-adaptive-secondary">Ø¢Ø®Ø± ØªØ²Ø§Ù…Ù†:</span>
<span class="font-bold text-adaptive text-xs" id="lastSyncDisplay">
${syncSystem && syncSystem.lastSyncTime ? new Date(syncSystem.lastSyncTime).toLocaleString('ar-SA') : 'Ù„Ù… ÙŠØªÙ… Ø¨Ø¹Ø¯'}
</span>
</div>
</div>
</div>

<!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ²Ø§Ù…Ù† -->
<div class="bg-white dark:bg-gray-700 rounded-lg shadow-lg p-6">
<h3 class="text-lg font-bold text-adaptive mb-4 flex items-center">
<span class="text-2xl ml-2">ğŸ› ï¸</span>
Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ²Ø§Ù…Ù†
</h3>
<div class="space-y-3">
<button onclick="testGitHubConnection()"
class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg transition-all font-medium">
ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ GitHub
</button>
<button onclick="forceSyncNow()"
class="w-full bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg transition-all font-medium">
ğŸ”„ Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„Ø¢Ù†
</button>
<button onclick="viewGitHubRepo()"
class="w-full bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg transition-all font-medium">
ğŸŒ Ø¹Ø±Ø¶ GitHub Repository
</button>
<button onclick="downloadBackup()"
class="w-full bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded-lg transition-all font-medium">
ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
</button>
</div>
</div>
</div>
`;
}

// Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹
async function handleSaveSettings(event) {
event.preventDefault();
const form = event.target;
const elements = form.elements;

const newSettings = {
companyName: elements[0].value,
address: elements[1].value,
phone: elements[2].value,
whatsapp: elements[3].value,
email: elements[4].value,
description: elements[5].value
};

await saveToStorage('siteSettings', newSettings);
updateFooter();
showNotification('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');
}

// Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø©
function showAddUnitForm() {
currentImages = [];
currentAvailability = {};
generateDateRange().forEach(dateStr => {
currentAvailability[dateStr] = { available: true, price: 50 };
});

const content = document.getElementById('admin-content');
content.innerHTML = `
<div class="mb-6">
<div class="flex items-center space-x-4 space-x-reverse">
<button onclick="showAdminTab('units')" class="text-adaptive-secondary hover:text-adaptive">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
<h2 class="text-xl font-bold text-adaptive">Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
</div>
</div>

<form onsubmit="handleSaveUnit(event)" class="space-y-6">
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ø³Ù… Ø§Ù„ÙˆØ­Ø¯Ø©</label>
<input type="text" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ù„Ù†ÙˆØ¹</label>
<select required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹</option>
<option value="Ø´Ù‚Ø©">Ø´Ù‚Ø©</option>
<option value="ØºØ±ÙØ©">ØºØ±ÙØ©</option>
<option value="ÙÙŠÙ„Ø§">ÙÙŠÙ„Ø§</option>
<option value="Ø¨ÙŠØª">Ø¨ÙŠØª</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
<select required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹</option>
<option value="ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</option>
<option value="ØµÙ„Ø§Ù„Ø© Ø§Ù„ÙˆØ³Ø·Ù‰">ØµÙ„Ø§Ù„Ø© Ø§Ù„ÙˆØ³Ø·Ù‰</option>
<option value="ØµÙ„Ø§Ù„Ø© Ø§Ù„ØºØ±Ø¨ÙŠØ©">ØµÙ„Ø§Ù„Ø© Ø§Ù„ØºØ±Ø¨ÙŠØ©</option>
<option value="Ø¹ÙˆÙ‚Ø¯">Ø¹ÙˆÙ‚Ø¯</option>
<option value="Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©">Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©</option>
<option value="ØµØ­Ù†ÙˆØª">ØµØ­Ù†ÙˆØª</option>
<option value="Ø±ÙŠØ³ÙˆØª">Ø±ÙŠØ³ÙˆØª</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨</label>
<input type="tel" placeholder="+968xxxxxxxx" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
<input type="tel" placeholder="+968xxxxxxxx" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ù„ÙˆØµÙ</label>
<textarea required rows="4" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base"></textarea>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ù„ØµÙˆØ± (Ø­ØªÙ‰ ${APP_CONFIG.MAX_IMAGES} ØµÙˆØ±ØŒ 5 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª Ù„ÙƒÙ„ ØµÙˆØ±Ø©)</label>
<div class="file-upload-area" onclick="document.getElementById('imageInput').click()">
<div class="text-4xl mb-2">ğŸ“·</div>
<div class="text-adaptive font-medium">Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ±</div>
<div class="text-adaptive-secondary text-sm">Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ± Ù‡Ù†Ø§</div>
</div>
<input type="file" id="imageInput" multiple accept="image/*" onchange="handleImageSelection(this.files)" class="hidden">
<div id="image-preview-container" class="mt-4"></div>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„ØªÙˆÙØ± (ÙŠÙˆÙ†ÙŠÙˆ - Ø³Ø¨ØªÙ…Ø¨Ø±)</label>
${generatePricingInterface()}
</div>

<div class="flex space-x-4 space-x-reverse">
<button type="submit" class="bg-accent hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium transition-all">
Ø­ÙØ¸ Ø§Ù„ÙˆØ­Ø¯Ø©
</button>
<button type="button" onclick="showAdminTab('units')" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-all">
Ø¥Ù„ØºØ§Ø¡
</button>
</div>
</form>
`;
}

// Ø­ÙØ¸ Ø§Ù„ÙˆØ­Ø¯Ø©
async function handleSaveUnit(event) {
event.preventDefault();
const form = event.target;
const elements = form.elements;

if (currentImages.length === 0) {
showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
return;
}

const newUnit = {
id: Date.now(),
name: elements[0].value,
type: elements[1].value,
location: elements[2].value,
description: elements[5].value,
contact: {
whatsapp: elements[3].value,
phone: elements[4].value
},
images: [...currentImages],
availability: { ...currentAvailability }
};

units.push(newUnit);
await saveToStorage('units', units);
loadUnits();
showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ­Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
showAdminTab('units');
}

// ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ­Ø¯Ø©
function editUnit(unitId) {
const unit = units.find(u => u.id === unitId);
if (!unit) return;

currentImages = [...unit.images];
currentAvailability = { ...unit.availability };

const content = document.getElementById('admin-content');
content.innerHTML = `
<div class="mb-6">
<div class="flex items-center space-x-4 space-x-reverse">
<button onclick="showAdminTab('units')" class="text-adaptive-secondary hover:text-adaptive">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
<h2 class="text-xl font-bold text-adaptive">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ­Ø¯Ø©</h2>
</div>
</div>

<form onsubmit="handleUpdateUnit(event, ${unitId})" class="space-y-6">
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ø³Ù… Ø§Ù„ÙˆØ­Ø¯Ø©</label>
<input type="text" value="${unit.name}" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ù„Ù†ÙˆØ¹</label>
<select required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
<option value="Ø´Ù‚Ø©" ${unit.type === 'Ø´Ù‚Ø©' ? 'selected' : ''}>Ø´Ù‚Ø©</option>
<option value="ØºØ±ÙØ©" ${unit.type === 'ØºØ±ÙØ©' ? 'selected' : ''}>ØºØ±ÙØ©</option>
<option value="ÙÙŠÙ„Ø§" ${unit.type === 'ÙÙŠÙ„Ø§' ? 'selected' : ''}>ÙÙŠÙ„Ø§</option>
<option value="Ø¨ÙŠØª" ${unit.type === 'Ø¨ÙŠØª' ? 'selected' : ''}>Ø¨ÙŠØª</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
<select required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
<option value="ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" ${unit.location === 'ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©' ? 'selected' : ''}>ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</option>
<option value="ØµÙ„Ø§Ù„Ø© Ø§Ù„ÙˆØ³Ø·Ù‰" ${unit.location === 'ØµÙ„Ø§Ù„Ø© Ø§Ù„ÙˆØ³Ø·Ù‰' ? 'selected' : ''}>ØµÙ„Ø§Ù„Ø© Ø§Ù„ÙˆØ³Ø·Ù‰</option>
<option value="ØµÙ„Ø§Ù„Ø© Ø§Ù„ØºØ±Ø¨ÙŠØ©" ${unit.location === 'ØµÙ„Ø§Ù„Ø© Ø§Ù„ØºØ±Ø¨ÙŠØ©' ? 'selected' : ''}>ØµÙ„Ø§Ù„Ø© Ø§Ù„ØºØ±Ø¨ÙŠØ©</option>
<option value="Ø¹ÙˆÙ‚Ø¯" ${unit.location === 'Ø¹ÙˆÙ‚Ø¯' ? 'selected' : ''}>Ø¹ÙˆÙ‚Ø¯</option>
<option value="Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©" ${unit.location === 'Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©' ? 'selected' : ''}>Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©</option>
<option value="ØµØ­Ù†ÙˆØª" ${unit.location === 'ØµØ­Ù†ÙˆØª' ? 'selected' : ''}>ØµØ­Ù†ÙˆØª</option>
<option value="Ø±ÙŠØ³ÙˆØª" ${unit.location === 'Ø±ÙŠØ³ÙˆØª' ? 'selected' : ''}>Ø±ÙŠØ³ÙˆØª</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨</label>
<input type="tel" value="${unit.contact.whatsapp}" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
<input type="tel" value="${unit.contact.phone}" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ù„ÙˆØµÙ</label>
<textarea required rows="4" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">${unit.description}</textarea>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø§Ù„ØµÙˆØ±</label>
<div class="file-upload-area" onclick="document.getElementById('imageInput').click()">
<div class="text-4xl mb-2">ğŸ“·</div>
<div class="text-adaptive font-medium">Ø§Ø¶ØºØ· Ù„ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±</div>
</div>
<input type="file" id="imageInput" multiple accept="image/*" onchange="handleImageSelection(this.files)" class="hidden">
<div id="image-preview-container" class="mt-4"></div>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„ØªÙˆÙØ±</label>
${generatePricingInterface()}
</div>

<div class="flex space-x-4 space-x-reverse">
<button type="submit" class="bg-oman-blue hover:bg-oman-light text-white px-6 py-3 rounded-lg font-medium transition-all">
ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ­Ø¯Ø©
</button>
<button type="button" onclick="showAdminTab('units')" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-all">
Ø¥Ù„ØºØ§Ø¡
</button>
</div>
</form>
`;

setTimeout(updateImagePreview, 100);
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ­Ø¯Ø©
async function handleUpdateUnit(event, unitId) {
event.preventDefault();
const form = event.target;
const elements = form.elements;

if (currentImages.length === 0) {
showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
return;
}

const unitIndex = units.findIndex(u => u.id === unitId);
if (unitIndex === -1) return;

units[unitIndex] = {
...units[unitIndex],
name: elements[0].value,
type: elements[1].value,
location: elements[2].value,
description: elements[5].value,
contact: {
whatsapp: elements[3].value,
phone: elements[4].value
},
images: [...currentImages],
availability: { ...currentAvailability }
};

await saveToStorage('units', units);
loadUnits();
showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ­Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
showAdminTab('units');
}

// Ø­Ø°Ù Ø§Ù„ÙˆØ­Ø¯Ø©
async function deleteUnit(unitId) {
if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ­Ø¯Ø©ØŸ')) return;

units = units.filter(u => u.id !== unitId);
await saveToStorage('units', units);
loadUnits();
showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙˆØ­Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
showAdminTab('units');
}

// ğŸ”‘ Ø¯Ø§Ù„Ø© Ø­ÙØ¸ GitHub Token
function setGitHubToken() {
const token = document.getElementById('githubToken').value.trim();
const statusDiv = document.getElementById('tokenStatus');

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Token
if (!token) {
statusDiv.innerHTML = '<span class="text-red-600">âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ GitHub Personal Access Token</span>';
return;
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù€ Token
if (!token.startsWith('ghp_') && !token.startsWith('github_pat_')) {
statusDiv.innerHTML = '<span class="text-yellow-600">âš ï¸ ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Token (ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ ghp_ Ø£Ùˆ github_pat_)</span>';
return;
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø·ÙˆÙ„ Ø§Ù„Ù€ Token
if (token.length < 30) {
statusDiv.innerHTML = '<span class="text-yellow-600">âš ï¸ Ø§Ù„Ù€ Token Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù†Ø³Ø® Ø§Ù„ÙƒØ§Ù…Ù„</span>';
return;
}

// Ø­ÙØ¸ Ø§Ù„Ù€ Token
if (syncSystem) {
statusDiv.innerHTML = '<span class="text-blue-600">ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Token...</span>';

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù€ Token
syncSystem.githubSync.validateToken(token).then(isValid => {
if (isValid) {
syncSystem.setAdminToken(token);
statusDiv.innerHTML = '<span class="text-green-600">âœ… ØªÙ… Ø­ÙØ¸ GitHub Token Ø¨Ù†Ø¬Ø§Ø­!</span>';

// Ù…Ø³Ø­ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
document.getElementById('githubToken').value = '';

showNotification('ØªÙ… Ø­ÙØ¸ GitHub Token Ø¨Ù†Ø¬Ø§Ø­!', 'success');

// ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ²Ø§Ù…Ù† Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ©
setTimeout(() => {
if (document.getElementById('admin-content')) {
document.getElementById('admin-content').innerHTML = getAdminSyncContent();
}
}, 1000);
} else {
statusDiv.innerHTML = '<span class="text-red-600">âŒ Token ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ù„Ø§ ÙŠÙ…Ù„Ùƒ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</span>';
}
}).catch(error => {
statusDiv.innerHTML = '<span class="text-red-600">âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Token: ' + error.message + '</span>';
});
} else {
statusDiv.innerHTML = '<span class="text-red-600">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©</span>';
}
}

// ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ GitHub
async function testGitHubConnection() {
if (!syncSystem) {
showNotification('Ø®Ø·Ø£: Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ²Ø§Ù…Ù† ØºÙŠØ± Ù…Ù‡ÙŠØ£', 'error');
return;
}

if (!syncSystem.adminToken) {
showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ GitHub Personal Access Token Ø£ÙˆÙ„Ø§Ù‹', 'error');
return;
}

try {
showNotification('Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ GitHub Repository...', 'info');

// Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
const data = await syncSystem.fetchRemoteData();

if (data) {
showNotification('âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ GitHub Repository Ø¨Ù†Ø¬Ø§Ø­!', 'success');

// ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± ØªØ²Ø§Ù…Ù† ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
const lastSyncDisplay = document.getElementById('lastSyncDisplay');
if (lastSyncDisplay) {
lastSyncDisplay.textContent = new Date().toLocaleString('ar-SA');
}
} else {
showNotification('âŒ ÙØ´Ù„ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub Repository', 'error');
}
} catch (error) {
showNotification('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message, 'error');
}
}

// ğŸŒ Ø¹Ø±Ø¶ GitHub Repository ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙŠØ¯
function viewGitHubRepo() {
const config = APP_CONFIG.GITHUB_CONFIG;
const repoUrl = `https://github.com/${config.owner}/${config.repo}`;
window.open(repoUrl, '_blank');
}

// ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function downloadBackup() {
try {
const backupData = {
units: units,
siteSettings: siteSettings,
messages: messages,
exportDate: new Date().toISOString(),
version: '2.1'
};

const jsonString = JSON.stringify(backupData, null, 2);
const blob = new Blob([jsonString], { type: 'application/json' });
const url = URL.createObjectURL(blob);

const link = document.createElement('a');
link.href = url;
link.download = `almosdaqiya-backup-${new Date().toISOString().split('T')[0]}.json`;
document.body.appendChild(link);
link.click();
document.body.removeChild(link);
URL.revokeObjectURL(url);

showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
} catch (error) {
showNotification('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: ' + error.message, 'error');
}
}

// ğŸ”„ Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„Ø¢Ù†
async function forceSyncNow() {
if (!syncSystem) {
showNotification('Ø®Ø·Ø£: Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ²Ø§Ù…Ù† ØºÙŠØ± Ù…Ù‡ÙŠØ£', 'error');
return;
}

try {
showNotification('Ø¬Ø§Ø±ÙŠ Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„ØªØ²Ø§Ù…Ù†...', 'info');

// ØªØ­Ø¯ÙŠØ« Ù…Ù† GitHub
await syncSystem.checkForUpdates();

// Ù…Ø¹Ø§Ù„Ø¬Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ²Ø§Ù…Ù†
await syncSystem.processSyncQueue();

showNotification('âœ… ØªÙ… Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„ØªØ²Ø§Ù…Ù† Ø¨Ù†Ø¬Ø§Ø­!', 'success');

// ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
loadUnits();
updateFooter();

} catch (error) {
showNotification('âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„ØªØ²Ø§Ù…Ù†: ' + error.message, 'error');
}
}

// Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
function closeAdminPanel() {
document.getElementById('adminPanel').classList.add('hidden');
currentUser = null;
// Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø¤Ø´Ø±
if (syncSystem) {
syncSystem.setAdminMode(false);
const indicator = document.getElementById('syncIndicator');
indicator.style.display = 'none';
}
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
function showNotification(message, type = 'info') {
const notification = document.createElement('div');
const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';

notification.className = `fixed top-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50 p-4 rounded-lg shadow-lg ${bgColor} text-white`;
notification.innerHTML = `
<div class="flex justify-between items-center">
<span>${message}</span>
<button onclick="this.parentElement.parentElement.remove()" class="text-white hover:text-gray-200 text-xl">Ã—</button>
</div>
`;

document.body.appendChild(notification);
setTimeout(() => notification.remove(), 5000);
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', initApp);

// Ù…Ø³ØªÙ…Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¹Ø¨Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
window.addEventListener('storage', (event) => {
if (event.key === 'almosdaqiya_last_update' || event.key === 'almosdaqiya_backup') {
if (syncSystem && !syncSystem.isAdmin) {
// Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ†
syncSystem.loadLocalBackup();
console.log('ğŸ”„ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† ØªØ¨ÙˆÙŠØ¨ Ø¢Ø®Ø±');
}
}
});

// Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø®ØµØµØ©
window.addEventListener('dataUpdated', () => {
if (syncSystem) {
syncSystem.loadLocalBackup();
}
});
// ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
window.addEventListener('beforeunload', () => {
if (syncSystem) {
syncSystem.destroy();
}
});
</script>
</body>
</html>
