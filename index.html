<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>المصداقية لتأجير الوحدات السكنية</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
<script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">
<script>
tailwind.config = {
theme: {
extend: {
fontFamily: {
'cairo': ['Cairo', 'sans-serif'],
},
colors: {
'oman-blue': '#003f7f',
'oman-light': '#4a90e2',
'accent': '#22c55e',
'warning': '#f59e0b',
}
}
}
}
</script>
<style>
* {
font-family: 'Cairo', sans-serif;
}

.neumorphic {
background: #f7fafc;
box-shadow: 20px 20px 60px #d1d9e6, -20px -20px 60px #ffffff;
}

.dark .neumorphic {
background: #2d3748;
box-shadow: 20px 20px 60px #1a202c, -20px -20px 60px #4a5568;
}

.swiper-pagination-bullet {
background: #4a90e2;
}

.available-day {
background: linear-gradient(45deg, #22c55e, #16a34a);
color: white;
}

.booked-day {
background: linear-gradient(45deg, #ef4444, #dc2626);
color: white;
}

.selected-day {
background: linear-gradient(45deg, #4a90e2, #3b82f6);
color: white;
border: 2px solid #1d4ed8;
}

.fade-in {
animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(20px); }
to { opacity: 1; transform: translateY(0); }
}

/* إصلاح مشكلة التمرير في النوافذ المنبثقة */
.modal-container {
overflow-y: auto;
max-height: 100vh;
padding: 1rem;
}

.modal-content {
max-height: calc(100vh - 2rem);
overflow-y: auto;
}

/* إصلاح مشكلة ألوان النصوص */
.text-adaptive {
color: #374151;
}

.dark .text-adaptive {
color: #f3f4f6;
}

.text-adaptive-secondary {
color: #6b7280;
}

.dark .text-adaptive-secondary {
color: #d1d5db;
}

/* جدول التقويم المنزلق */
.calendar-slider {
max-height: 400px;
overflow-y: auto;
border: 2px solid #e5e7eb;
border-radius: 12px;
background: #f9fafb;
}

.dark .calendar-slider {
border-color: #374151;
background: #1f2937;
}

.calendar-day-row {
min-height: 50px;
transition: all 0.3s ease;
}

.calendar-day-row:hover {
background-color: #f3f4f6;
}

.dark .calendar-day-row:hover {
background-color: #374151;
}

/* معاينة الصور */
.image-preview {
position: relative;
display: inline-block;
margin: 8px;
}

.image-preview img {
width: 120px;
height: 120px;
object-fit: cover;
border-radius: 12px;
border: 3px solid #e5e7eb;
transition: all 0.3s ease;
}

.image-preview:hover img {
border-color: #4a90e2;
}

.remove-image-btn {
position: absolute;
top: -10px;
right: -10px;
background: #ef4444;
color: white;
border-radius: 50%;
width: 28px;
height: 28px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
font-size: 16px;
font-weight: bold;
box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

.remove-image-btn:hover {
background: #dc2626;
}

/* تحسين شكل رفع الملفات */
.file-upload-area {
border: 3px dashed #d1d5db;
border-radius: 12px;
padding: 40px;
text-align: center;
transition: all 0.3s ease;
cursor: pointer;
}

.file-upload-area:hover {
border-color: #4a90e2;
background-color: #f8fafc;
}

.dark .file-upload-area {
border-color: #4b5563;
background-color: #1f2937;
}

.dark .file-upload-area:hover {
border-color: #4a90e2;
background-color: #374151;
}
</style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-all duration-300">
<!-- Header -->
<header class="bg-white dark:bg-gray-800 shadow-lg transition-all duration-300">
<div class="container mx-auto px-4 py-4">
<div class="flex justify-between items-center">
<div class="flex items-center space-x-4 space-x-reverse">
<div class="w-12 h-12 bg-gradient-to-br from-oman-blue to-oman-light rounded-lg flex items-center justify-center">
<span class="text-white font-bold text-xl">م</span>
</div>
<div>
<h1 class="text-2xl font-bold text-oman-blue dark:text-oman-light">المصداقية</h1>
<p class="text-sm text-adaptive-secondary">للعقارات</p>
</div>
</div>

<div class="flex items-center space-x-4 space-x-reverse">
<button onclick="toggleDarkMode()" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-all duration-300">
<span id="theme-icon" class="text-xl">🌙</span>
</button>
<button onclick="showAdminLogin()" class="px-4 py-2 bg-oman-blue hover:bg-oman-light text-white rounded-lg transition-all duration-300">
لوحة الإدارة
</button>
</div>
</div>
</div>
</header>

<!-- Main Content -->
<main id="main-content" class="container mx-auto px-4 py-8">
<!-- Filters Section -->
<div class="neumorphic rounded-2xl p-6 mb-8 fade-in">
<h2 class="text-xl font-bold text-adaptive mb-4">البحث والفلترة</h2>
<div class="grid grid-cols-1 md:grid-cols-4 gap-4">
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">النوع</label>
<select id="typeFilter" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
<option value="">جميع الأنواع</option>
<option value="شقة">شقق</option>
<option value="غرفة">غرف</option>
<option value="فيلا">فلل</option>
<option value="بيت">بيوت</option>
</select>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">السعر (ريال عماني)</label>
<select id="priceFilter" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
<option value="">جميع الأسعار</option>
<option value="0-30">أقل من 30</option>
<option value="30-60">30 - 60</option>
<option value="60-90">60 - 90</option>
<option value="90+">90 وأكثر</option>
</select>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">الموقع</label>
<select id="locationFilter" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
<option value="">جميع المواقع</option>
<option value="صلالة الجديدة">صلالة الجديدة</option>
<option value="صلالة الوسطى">صلالة الوسطى</option>
<option value="صلالة الغربية">صلالة الغربية</option>
<option value="عوقد">عوقد</option>
<option value="السعادة">السعادة</option>
<option value="صحنوت">صحلنوت</option>
<option value="ريسوت">ريسوت</option>
</select>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">البحث</label>
<input id="searchInput" type="text" placeholder="اسم الوحدة أو الوصف..." class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
</div>
</div>

<!-- Units Grid -->
<div id="unitsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
<!-- Units will be loaded here -->
</div>
</main>

<!-- Admin Panel -->
<div id="adminPanel" class="hidden fixed inset-0 z-50 bg-gray-900 bg-opacity-75">
<div class="modal-container flex items-center justify-center">
<div class="modal-content bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-6xl">
<!-- Admin content will be loaded here -->
</div>
</div>
</div>

<!-- Unit Details Modal -->
<div id="unitModal" class="hidden fixed inset-0 z-40 bg-gray-900 bg-opacity-75">
<div class="modal-container flex items-center justify-center">
<div class="modal-content bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-4xl">
<!-- Unit details will be loaded here -->
</div>
</div>
</div>

<!-- Contact Modal -->
<div id="contactModal" class="hidden fixed inset-0 z-40 bg-gray-900 bg-opacity-75">
<div class="modal-container flex items-center justify-center">
<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md mx-4">
<div class="p-6">
<div class="flex justify-between items-center mb-4">
<h3 class="text-xl font-bold text-adaptive">إرسال رسالة</h3>
<button onclick="closeContactModal()" class="text-adaptive-secondary hover:text-adaptive">
<span class="text-2xl">×</span>
</button>
</div>
<form id="contactForm" class="space-y-4">
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">الاسم</label>
<input type="text" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">رقم الهاتف</label>
<input type="tel" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">الرسالة</label>
<textarea required rows="4" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base"></textarea>
</div>
<button type="submit" class="w-full bg-accent hover:bg-green-600 text-white py-3 rounded-lg font-medium transition-all duration-300">
إرسال الرسالة
</button>
</form>
</div>
</div>
</div>
</div>

<!-- Footer -->
<footer class="bg-oman-blue dark:bg-gray-800 text-white py-8 mt-16">
<div class="container mx-auto px-4">
<div class="grid grid-cols-1 md:grid-cols-3 gap-8">
<div>
<h3 class="text-xl font-bold mb-4" id="footer-company-name">المصداقية لتأجير الوحدات</h3>
<p class="text-gray-300" id="footer-description">نوفر أفضل الوحدات السكنية للإيجار في صلالة وضواحيها بأسعار مناسبة وخدمة متميزة.</p>
</div>
<div>
<h3 class="text-xl font-bold mb-4">التواصل</h3>
<div class="space-y-2">
<p id="footer-whatsapp">📱 واتساب: +968 9876 5432</p>
<p id="footer-phone">📞 هاتف: +968 2345 6789</p>
<p id="footer-email">✉️ البريد: info@almosdaqiya.om</p>
<p id="footer-address">📍 العنوان: صلالة، سلطنة عمان</p>
</div>
</div>
<div>
<h3 class="text-xl font-bold mb-4">روابط سريعة</h3>
<div class="space-y-2">
<a href="#" class="block hover:text-oman-light transition-colors">سياسة الخصوصية</a>
<a href="#" class="block hover:text-oman-light transition-colors">شروط الاستخدام</a>
<a href="#" class="block hover:text-oman-light transition-colors">من نحن</a>
</div>
</div>
</div>
<div class="border-t border-gray-600 mt-8 pt-8 text-center">
<p>&copy; 2024 المصداقية لتأجير الوحدات السكنية. جميع الحقوق محفوظة.</p>
</div>
</div>
</footer>

<script>
// إعدادات التطبيق
const APP_CONFIG = {
MAX_IMAGES: 10,
MAX_FILE_SIZE: 5 * 1024 * 1024, // 5MB
CALENDAR_START: { month: 5, day: 1 }, // يونيو 1
CALENDAR_END: { month: 8, day: 1 }, // سبتمبر 1
ADMIN_CREDENTIALS: { username: 'AbuSalim', password: '19802002' }
};

// أسماء الأيام والشهور العربية
const ARABIC_DAYS = ['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
const ARABIC_MONTHS = [
'يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو',
'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'
];

// متغيرات التطبيق
let siteSettings = loadFromStorage('siteSettings', {
phone: '+968 2345 6789',
whatsapp: '+968 9876 5432',
email: 'info@almosdaqiya.om',
address: 'صلالة، سلطنة عمان',
companyName: 'المصداقية لتأجير الوحدات السكنية',
description: 'نوفر أفضل الوحدات السكنية للإيجار في صلالة وضواحيها بأسعار مناسبة وخدمة متميزة.'
});

let units = loadFromStorage('units', [
{
id: 1,
name: "شقة الخليج الراقية",
type: "شقة",
location: "صلالة الجديدة",
description: "شقة مفروشة بالكامل مع إطلالة رائعة على البحر، تحتوي على غرفتين وصالة ومطبخ مجهز",
images: ["https://picsum.photos/400/300?random=1", "https://picsum.photos/400/300?random=2"],
availability: generateSampleAvailability(),
contact: { whatsapp: "+96812345678", phone: "+96812345678" }
}
]);

let messages = loadFromStorage('messages', []);
let currentUser = null;
let selectedDates = [];
let currentUnit = null;
let currentImages = [];
let currentAvailability = {};

// وظائف التخزين
function loadFromStorage(key, defaultValue) {
try {
const stored = sessionStorage.getItem(key);
return stored ? JSON.parse(stored) : defaultValue;
} catch (e) {
console.warn('خطأ في تحميل البيانات:', e);
return defaultValue;
}
}

function saveToStorage(key, value) {
try {
sessionStorage.setItem(key, JSON.stringify(value));
} catch (e) {
console.warn('خطأ في حفظ البيانات:', e);
}
}

// توليد بيانات التوفر التجريبية
function generateSampleAvailability() {
const availability = {};
const dates = generateDateRange();

dates.forEach(dateStr => {
const isAvailable = Math.random() > 0.3; // 70% متاح
const basePrice = 40 + Math.floor(Math.random() * 60); // 40-100 ريال

availability[dateStr] = {
available: isAvailable,
price: basePrice
};
});

return availability;
}

// توليد نطاق التواريخ من يونيو إلى سبتمبر
function generateDateRange() {
const dates = [];
const currentYear = new Date().getFullYear();
const startDate = new Date(currentYear, APP_CONFIG.CALENDAR_START.month, APP_CONFIG.CALENDAR_START.day);
const endDate = new Date(currentYear, APP_CONFIG.CALENDAR_END.month, APP_CONFIG.CALENDAR_END.day);

for (let date = new Date(startDate); date <= endDate; date.setDate(date.getDate() + 1)) {
dates.push(date.toISOString().split('T')[0]);
}

return dates;
}

// تهيئة التطبيق
function initApp() {
setupEventListeners();
initDarkMode();
updateFooter();
loadUnits();
}

// إعداد مستمعي الأحداث
function setupEventListeners() {
document.getElementById('typeFilter').addEventListener('change', filterUnits);
document.getElementById('priceFilter').addEventListener('change', filterUnits);
document.getElementById('locationFilter').addEventListener('change', filterUnits);
document.getElementById('searchInput').addEventListener('input', filterUnits);
document.getElementById('contactForm').addEventListener('submit', handleContactSubmit);
}

// الوضع الليلي
function initDarkMode() {
if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
document.documentElement.classList.add('dark');
}
updateThemeIcon();

window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
document.documentElement.classList.toggle('dark', event.matches);
updateThemeIcon();
});
}

function toggleDarkMode() {
document.documentElement.classList.toggle('dark');
updateThemeIcon();
}

function updateThemeIcon() {
const icon = document.getElementById('theme-icon');
const isDark = document.documentElement.classList.contains('dark');
icon.textContent = isDark ? '☀️' : '🌙';
}

// تحديث تذييل الموقع
function updateFooter() {
document.getElementById('footer-company-name').textContent = siteSettings.companyName;
document.getElementById('footer-description').textContent = siteSettings.description;
document.getElementById('footer-whatsapp').textContent = `📱 واتساب: ${siteSettings.whatsapp}`;
document.getElementById('footer-phone').textContent = `📞 هاتف: ${siteSettings.phone}`;
document.getElementById('footer-email').textContent = `✉️ البريد: ${siteSettings.email}`;
document.getElementById('footer-address').textContent = `📍 العنوان: ${siteSettings.address}`;
}

// تحميل وعرض الوحدات
function loadUnits() {
const grid = document.getElementById('unitsGrid');
grid.innerHTML = '';

units.forEach(unit => {
const unitCard = createUnitCard(unit);
grid.appendChild(unitCard);
});

// تهيئة المنزلقات
setTimeout(initSwipers, 100);
}

// إنشاء بطاقة الوحدة
function createUnitCard(unit) {
const card = document.createElement('div');
card.className = 'neumorphic rounded-2xl overflow-hidden fade-in hover:shadow-2xl transition-all duration-300';

const availableDates = Object.entries(unit.availability)
.filter(([date, info]) => info.available)
.slice(0, 5);

const avgPrice = availableDates.length > 0
? Math.round(availableDates.reduce((sum, [, info]) => sum + info.price, 0) / availableDates.length)
: 50;

card.innerHTML = `
<div class="relative">
<div class="swiper" id="swiper-${unit.id}">
<div class="swiper-wrapper">
${unit.images.map(img => `
<div class="swiper-slide">
<img src="${img}" alt="${unit.name}" class="w-full h-48 object-cover">
</div>
`).join('')}
</div>
<div class="swiper-pagination"></div>
<div class="swiper-button-next"></div>
<div class="swiper-button-prev"></div>
</div>
<div class="absolute top-2 right-2 bg-oman-blue text-white px-2 py-1 rounded-lg text-sm font-bold">
${unit.type}
</div>
</div>

<div class="p-4">
<h3 class="text-lg font-bold text-adaptive mb-2">${unit.name}</h3>
<p class="text-sm text-adaptive-secondary mb-2">📍 ${unit.location}</p>
<p class="text-sm text-adaptive mb-4">${unit.description}</p>

<div class="mb-4">
<h4 class="text-sm font-medium text-adaptive-secondary mb-2">الأيام المتاحة القادمة</h4>
<div class="grid grid-cols-5 gap-1">
${availableDates.map(([date, info]) => {
const dateObj = new Date(date);
const dayName = ARABIC_DAYS[dateObj.getDay()];
return `
<div class="text-center p-1 bg-accent text-white rounded text-xs">
<div class="font-bold">${dayName.substring(0, 3)}</div>
<div>${dateObj.getDate()}</div>
<div>${info.price}ر.ع</div>
</div>
`;
}).join('')}
</div>
</div>

<div class="flex justify-between items-center">
<div class="text-lg font-bold text-oman-blue dark:text-oman-light">
من ${avgPrice} ر.ع/ليلة
</div>
<div class="flex space-x-2 space-x-reverse">
<button onclick="showUnitDetails(${unit.id})" class="px-3 py-1 bg-oman-blue hover:bg-oman-light text-white rounded-lg text-sm transition-all">
التفاصيل
</button>
<a href="https://wa.me/${unit.contact.whatsapp}?text=${encodeURIComponent('مرحباً، أود الاستفسار عن ' + unit.name)}"
target="_blank"
class="px-3 py-1 bg-accent hover:bg-green-600 text-white rounded-lg text-sm transition-all inline-block text-center">
تواصل
</a>
</div>
</div>
</div>
`;

return card;
}

// تهيئة منزلقات الصور
function initSwipers() {
units.forEach(unit => {
new Swiper(`#swiper-${unit.id}`, {
pagination: { el: `#swiper-${unit.id} .swiper-pagination`, clickable: true },
navigation: {
nextEl: `#swiper-${unit.id} .swiper-button-next`,
prevEl: `#swiper-${unit.id} .swiper-button-prev`
},
loop: true
});
});
}

// تصفية الوحدات
function filterUnits() {
const filters = {
type: document.getElementById('typeFilter').value,
price: document.getElementById('priceFilter').value,
location: document.getElementById('locationFilter').value,
search: document.getElementById('searchInput').value.toLowerCase()
};

const filteredUnits = units.filter(unit => {
if (filters.type && unit.type !== filters.type) return false;
if (filters.location && unit.location !== filters.location) return false;
if (filters.search) {
const searchText = (unit.name + ' ' + unit.description).toLowerCase();
if (!searchText.includes(filters.search)) return false;
}
if (filters.price) {
const avgPrice = getUnitAveragePrice(unit);
const [min, max] = filters.price.split('-').map(p => p.replace('+', ''));
if (max && (avgPrice < parseInt(min) || avgPrice > parseInt(max))) return false;
if (!max && avgPrice < parseInt(min)) return false;
}
return true;
});

displayFilteredUnits(filteredUnits);
}

// حساب متوسط سعر الوحدة
function getUnitAveragePrice(unit) {
const prices = Object.values(unit.availability)
.filter(info => info.available)
.map(info => info.price);
return prices.length > 0 ? Math.round(prices.reduce((a, b) => a + b, 0) / prices.length) : 0;
}

// عرض الوحدات المصفاة
function displayFilteredUnits(filteredUnits) {
const grid = document.getElementById('unitsGrid');

if (filteredUnits.length === 0) {
grid.innerHTML = `
<div class="col-span-full text-center py-12">
<div class="text-6xl mb-4">🏠</div>
<h3 class="text-xl font-bold text-adaptive mb-2">لا توجد وحدات متاحة</h3>
<p class="text-adaptive-secondary">جرب تغيير معايير البحث</p>
</div>
`;
return;
}

grid.innerHTML = '';
filteredUnits.forEach(unit => {
const unitCard = createUnitCard(unit);
grid.appendChild(unitCard);
});

setTimeout(initSwipers, 100);
}

// عرض تفاصيل الوحدة
function showUnitDetails(unitId) {
const unit = units.find(u => u.id === unitId);
if (!unit) return;

currentUnit = unit;
selectedDates = [];

const modal = document.getElementById('unitModal');
modal.querySelector('.modal-content').innerHTML = `
<div class="p-6">
<div class="flex justify-between items-start mb-6">
<div>
<h2 class="text-2xl font-bold text-adaptive">${unit.name}</h2>
<p class="text-adaptive-secondary">📍 ${unit.location} • ${unit.type}</p>
</div>
<button onclick="closeUnitModal()" class="text-adaptive-secondary hover:text-adaptive text-3xl">×</button>
</div>

<div class="mb-6">
<div class="swiper" id="modal-swiper">
<div class="swiper-wrapper">
${unit.images.map(img => `
<div class="swiper-slide">
<img src="${img}" alt="${unit.name}" class="w-full h-64 md:h-96 object-cover rounded-lg">
</div>
`).join('')}
</div>
<div class="swiper-pagination"></div>
<div class="swiper-button-next"></div>
<div class="swiper-button-prev"></div>
</div>
</div>

<div class="mb-6">
<h3 class="text-lg font-bold text-adaptive mb-2">الوصف</h3>
<p class="text-adaptive">${unit.description}</p>
</div>

<div class="mb-6">
<h3 class="text-lg font-bold text-adaptive mb-4">التواريخ المتاحة وأسعارها (يونيو - سبتمبر)</h3>
<div class="calendar-slider">
${generateCalendarHTML(unit)}
</div>
<div id="selected-info" class="mt-4 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg hidden">
<h4 class="font-bold text-adaptive mb-2">التواريخ المختارة:</h4>
<div id="selected-dates" class="text-adaptive mb-2"></div>
<div id="total-price" class="text-xl font-bold text-oman-blue dark:text-oman-light mb-3"></div>
<button onclick="confirmBooking()" class="w-full bg-accent hover:bg-green-600 text-white py-2 rounded-lg font-medium transition-all">
تأكيد الحجز
</button>
</div>
</div>

<div class="border-t pt-6">
<h3 class="text-lg font-bold text-adaptive mb-4">معلومات التواصل</h3>
<div class="flex flex-wrap gap-4">
<a href="https://wa.me/${unit.contact.whatsapp}" target="_blank"
class="flex items-center space-x-2 space-x-reverse bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-all">
<span>💬</span><span>واتساب</span>
</a>
<a href="tel:${unit.contact.phone}"
class="flex items-center space-x-2 space-x-reverse bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-all">
<span>📞</span><span>اتصال مباشر</span>
</a>
<button onclick="showContactModal(${unit.id})"
class="flex items-center space-x-2 space-x-reverse bg-oman-blue hover:bg-oman-light text-white px-4 py-2 rounded-lg transition-all">
<span>✉️</span><span>إرسال رسالة</span>
</button>
</div>
</div>
</div>
`;

modal.classList.remove('hidden');

setTimeout(() => {
new Swiper('#modal-swiper', {
pagination: { el: '#modal-swiper .swiper-pagination', clickable: true },
navigation: {
nextEl: '#modal-swiper .swiper-button-next',
prevEl: '#modal-swiper .swiper-button-prev'
},
loop: true
});
}, 100);
}

// توليد HTML التقويم
function generateCalendarHTML(unit) {
let html = '';
const dates = generateDateRange();
let currentMonth = -1;

dates.forEach(dateStr => {
const date = new Date(dateStr);
const monthIndex = date.getMonth();

// إضافة رأس الشهر
if (monthIndex !== currentMonth) {
currentMonth = monthIndex;
html += `
<div class="bg-oman-blue text-white p-4 font-bold text-center text-lg sticky top-0 z-10">
${ARABIC_MONTHS[monthIndex]} ${date.getFullYear()}
</div>
`;
}

// التأكد من وجود بيانات اليوم أو إنشاؤها
const dayInfo = unit.availability[dateStr] || { available: true, price: 50 };
const dayName = ARABIC_DAYS[date.getDay()];
const isAvailable = dayInfo.available;
const price = dayInfo.price;

html += `
<div class="calendar-day-row flex items-center justify-between p-4 border-b dark:border-gray-600 transition-all duration-200 ${
isAvailable
? 'cursor-pointer hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:border-blue-300'
: 'opacity-60 bg-gray-50 dark:bg-gray-800'
}"
${isAvailable ? `onclick="selectDate('${dateStr}', ${price})"` : ''}
data-date="${dateStr}">
<div class="flex items-center space-x-4 space-x-reverse">
<div class="w-16 h-16 rounded-full bg-gradient-to-br ${
isAvailable
? 'from-accent to-green-600'
: 'from-gray-400 to-gray-500'
} flex items-center justify-center text-white font-bold">
${date.getDate()}
</div>
<div>
<div class="font-bold text-adaptive text-lg">${dayName}</div>
<div class="text-adaptive-secondary text-sm">${date.getDate()} ${ARABIC_MONTHS[monthIndex]} ${date.getFullYear()}</div>
</div>
</div>
<div class="flex items-center space-x-3 space-x-reverse">
${isAvailable
? `
<div class="text-center">
<div class="bg-accent text-white px-4 py-2 rounded-lg font-bold text-lg">${price} ر.ع</div>
<div class="text-accent text-sm font-medium mt-1">متاح للحجز</div>
</div>
`
: `
<div class="text-center">
<div class="bg-red-500 text-white px-4 py-2 rounded-lg font-bold">محجوز</div>
<div class="text-red-500 text-sm font-medium mt-1">غير متاح</div>
</div>
`
}
</div>
</div>
`;
});

return html;
}

// اختيار تاريخ للحجز
function selectDate(dateStr, price) {
const dateElement = document.querySelector(`[data-date="${dateStr}"]`);
const existingIndex = selectedDates.findIndex(d => d.date === dateStr);

if (existingIndex !== -1) {
selectedDates.splice(existingIndex, 1);
dateElement.classList.remove('bg-blue-100', 'dark:bg-blue-800');
} else {
selectedDates.push({ date: dateStr, price: price });
dateElement.classList.add('bg-blue-100', 'dark:bg-blue-800');
}

updateSelectedInfo();
}

// تحديث معلومات التواريخ المختارة
function updateSelectedInfo() {
const selectedInfo = document.getElementById('selected-info');
const selectedDatesDiv = document.getElementById('selected-dates');
const totalPriceDiv = document.getElementById('total-price');

if (selectedDates.length === 0) {
selectedInfo.classList.add('hidden');
return;
}

selectedInfo.classList.remove('hidden');

selectedDates.sort((a, b) => new Date(a.date) - new Date(b.date));

const datesText = selectedDates.map(d => {
const date = new Date(d.date);
const dayName = ARABIC_DAYS[date.getDay()];
const monthName = ARABIC_MONTHS[date.getMonth()];
return `${dayName} ${date.getDate()} ${monthName} (${d.price} ر.ع)`;
}).join(' • ');

selectedDatesDiv.textContent = datesText;

const total = selectedDates.reduce((sum, d) => sum + d.price, 0);
totalPriceDiv.textContent = `المجموع: ${total} ر.ع لمدة ${selectedDates.length} ليلة`;
}

// تأكيد الحجز
function confirmBooking() {
if (selectedDates.length === 0) return;

const total = selectedDates.reduce((sum, d) => sum + d.price, 0);
const datesText = selectedDates.map(d => {
const date = new Date(d.date);
const dayName = ARABIC_DAYS[date.getDay()];
const monthName = ARABIC_MONTHS[date.getMonth()];
return `${dayName} ${date.getDate()} ${monthName}`;
}).join(', ');

const message = `أود حجز ${currentUnit.name} للتواريخ التالية:\n${datesText}\nالمجموع: ${total} ر.ع`;
const whatsappUrl = `https://wa.me/${currentUnit.contact.whatsapp}?text=${encodeURIComponent(message)}`;

window.open(whatsappUrl, '_blank');
showNotification('تم إرسال طلب الحجز عبر واتساب!', 'success');
closeUnitModal();
}

// إغلاق نافذة تفاصيل الوحدة
function closeUnitModal() {
document.getElementById('unitModal').classList.add('hidden');
selectedDates = [];
currentUnit = null;
}

// عرض نافذة التواصل
function showContactModal(unitId) {
const unit = units.find(u => u.id === unitId);
currentUnit = unit;
document.getElementById('contactModal').classList.remove('hidden');
}

// إغلاق نافذة التواصل
function closeContactModal() {
document.getElementById('contactModal').classList.add('hidden');
document.getElementById('contactForm').reset();
}

// معالجة إرسال نموذج التواصل
function handleContactSubmit(event) {
event.preventDefault();
const form = event.target;

const message = {
id: Date.now(),
unitId: currentUnit.id,
unitName: currentUnit.name,
name: form.elements[0].value,
phone: form.elements[1].value,
message: form.elements[2].value,
timestamp: new Date().toISOString()
};

messages.push(message);
saveToStorage('messages', messages);

showNotification('تم إرسال رسالتك بنجاح! سنتواصل معك قريباً.', 'success');
closeContactModal();
}

// معالجة اختيار الصور
function handleImageSelection(files) {
const fileArray = Array.from(files);

if (fileArray.length > APP_CONFIG.MAX_IMAGES) {
showNotification(`يمكن رفع حتى ${APP_CONFIG.MAX_IMAGES} صور فقط`, 'error');
return;
}

currentImages = [];
let processedCount = 0;

fileArray.forEach(file => {
if (file.size > APP_CONFIG.MAX_FILE_SIZE) {
showNotification(`الملف ${file.name} كبير جداً. الحد الأقصى 5 ميجابايت`, 'error');
return;
}

if (!file.type.startsWith('image/')) {
showNotification(`الملف ${file.name} ليس صورة`, 'error');
return;
}

const reader = new FileReader();
reader.onload = function(e) {
currentImages.push(e.target.result);
processedCount++;

if (processedCount === fileArray.length) {
updateImagePreview();
}
};
reader.readAsDataURL(file);
});
}

// تحديث معاينة الصور
function updateImagePreview() {
const container = document.getElementById('image-preview-container');
if (!container) return;

container.innerHTML = '';
currentImages.forEach((src, index) => {
const div = document.createElement('div');
div.className = 'image-preview';
div.innerHTML = `
<img src="${src}" alt="صورة ${index + 1}">
<div class="remove-image-btn" onclick="removeImage(${index})">×</div>
`;
container.appendChild(div);
});
}

// حذف صورة
function removeImage(index) {
currentImages.splice(index, 1);
updateImagePreview();
}

// توليد جدول التوفر للإدارة
function generateAvailabilityAdmin() {
let html = '';
const dates = generateDateRange();
let currentMonth = -1;

dates.forEach(dateStr => {
const date = new Date(dateStr);
const monthIndex = date.getMonth();

if (monthIndex !== currentMonth) {
currentMonth = monthIndex;
html += `
<div class="bg-oman-blue text-white p-3 font-bold text-center">
${ARABIC_MONTHS[monthIndex]} ${date.getFullYear()}
</div>
`;
}

const dayName = ARABIC_DAYS[date.getDay()];
const existingData = currentAvailability[dateStr] || { available: true, price: 50 };

html += `
<div class="calendar-day-row flex items-center justify-between p-3 border-b dark:border-gray-600">
<div class="flex items-center space-x-3 space-x-reverse">
<span class="font-medium text-adaptive">${dayName}</span>
<span class="text-adaptive-secondary">${date.getDate()} ${ARABIC_MONTHS[monthIndex]}</span>
</div>
<div class="flex items-center space-x-3 space-x-reverse">
<label class="flex items-center">
<input type="checkbox" ${existingData.available ? 'checked' : ''}
onchange="updateAvailability('${dateStr}', 'available', this.checked)"
class="ml-2">
<span class="text-sm text-adaptive-secondary">متاح</span>
</label>
<input type="number"
value="${existingData.price}"
min="1"
onchange="updateAvailability('${dateStr}', 'price', parseInt(this.value))"
class="w-20 p-1 border rounded text-center text-sm bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive">
<span class="text-sm text-adaptive-secondary">ر.ع</span>
</div>
</div>
`;
});

return html;
}

// تحديث بيانات التوفر
function updateAvailability(dateStr, field, value) {
if (!currentAvailability[dateStr]) {
currentAvailability[dateStr] = { available: true, price: 50 };
}
currentAvailability[dateStr][field] = value;
}

// إدارة تسجيل دخول الإدارة
function showAdminLogin() {
const adminPanel = document.getElementById('adminPanel');
adminPanel.querySelector('.modal-content').innerHTML = `
<div class="p-8">
<div class="text-center mb-8">
<div class="w-16 h-16 bg-gradient-to-br from-oman-blue to-oman-light rounded-full flex items-center justify-center mx-auto mb-4">
<span class="text-white font-bold text-2xl">🔐</span>
</div>
<h2 class="text-2xl font-bold text-adaptive">تسجيل دخول الإدارة</h2>
</div>

<form onsubmit="handleAdminLogin(event)" class="space-y-6">
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">اسم المستخدم</label>
<input type="text" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">كلمة المرور</label>
<input type="password" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<button type="submit" class="w-full bg-oman-blue hover:bg-oman-light text-white py-3 rounded-lg font-medium transition-all">
دخول
</button>
<button type="button" onclick="closeAdminPanel()" class="w-full bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg font-medium transition-all">
إلغاء
</button>
</form>
</div>
`;
adminPanel.classList.remove('hidden');
}

// معالجة تسجيل دخول الإدارة
function handleAdminLogin(event) {
event.preventDefault();
const form = event.target;
const username = form.elements[0].value;
const password = form.elements[1].value;

if (username === APP_CONFIG.ADMIN_CREDENTIALS.username && password === APP_CONFIG.ADMIN_CREDENTIALS.password) {
currentUser = { username: 'admin', role: 'admin' };
showAdminDashboard();
} else {
showNotification('بيانات تسجيل الدخول غير صحيحة', 'error');
}
}

// عرض لوحة تحكم الإدارة
function showAdminDashboard() {
const adminPanel = document.getElementById('adminPanel');
adminPanel.querySelector('.modal-content').innerHTML = `
<div class="bg-gradient-to-r from-oman-blue to-oman-light text-white p-6 rounded-t-2xl">
<div class="flex justify-between items-center">
<div>
<h1 class="text-2xl font-bold">لوحة إدارة المصداقية</h1>
<p class="text-blue-100">مرحباً بك، ${currentUser.username}</p>
</div>
<button onclick="closeAdminPanel()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all">
خروج
</button>
</div>
</div>

<div class="border-b dark:border-gray-700">
<nav class="flex space-x-8 space-x-reverse px-6">
<button onclick="showAdminTab('units')" class="admin-tab-btn active px-4 py-3 font-medium border-b-2 border-oman-blue text-oman-blue">
إدارة الوحدات
</button>
<button onclick="showAdminTab('messages')" class="admin-tab-btn px-4 py-3 font-medium border-b-2 border-transparent text-adaptive-secondary hover:text-adaptive">
الرسائل (${messages.length})
</button>
<button onclick="showAdminTab('settings')" class="admin-tab-btn px-4 py-3 font-medium border-b-2 border-transparent text-adaptive-secondary hover:text-adaptive">
إعدادات الموقع
</button>
</nav>
</div>

<div id="admin-content" class="p-6">
${getAdminUnitsContent()}
</div>
`;
}

// عرض تبويب الإدارة
function showAdminTab(tab) {
document.querySelectorAll('.admin-tab-btn').forEach(btn => {
btn.classList.remove('active', 'border-oman-blue', 'text-oman-blue');
btn.classList.add('border-transparent', 'text-adaptive-secondary');
});

event.target.classList.add('active', 'border-oman-blue', 'text-oman-blue');
event.target.classList.remove('border-transparent', 'text-adaptive-secondary');

const content = document.getElementById('admin-content');
switch(tab) {
case 'units':
content.innerHTML = getAdminUnitsContent();
break;
case 'messages':
content.innerHTML = getAdminMessagesContent();
break;
case 'settings':
content.innerHTML = getAdminSettingsContent();
break;
}
}

// محتوى إدارة الوحدات
function getAdminUnitsContent() {
return `
<div class="mb-6">
<div class="flex justify-between items-center">
<h2 class="text-xl font-bold text-adaptive">إدارة الوحدات</h2>
<button onclick="showAddUnitForm()" class="bg-accent hover:bg-green-600 text-white px-6 py-2 rounded-lg font-medium transition-all">
+ إضافة وحدة جديدة
</button>
</div>
</div>

<div class="overflow-x-auto">
<table class="w-full bg-white dark:bg-gray-700 rounded-lg shadow">
<thead class="bg-gray-50 dark:bg-gray-800">
<tr>
<th class="px-6 py-3 text-right text-xs font-medium text-adaptive-secondary uppercase">الوحدة</th>
<th class="px-6 py-3 text-right text-xs font-medium text-adaptive-secondary uppercase">النوع</th>
<th class="px-6 py-3 text-right text-xs font-medium text-adaptive-secondary uppercase">الموقع</th>
<th class="px-6 py-3 text-right text-xs font-medium text-adaptive-secondary uppercase">متوسط السعر</th>
<th class="px-6 py-3 text-right text-xs font-medium text-adaptive-secondary uppercase">الإجراءات</th>
</tr>
</thead>
<tbody class="divide-y divide-gray-200 dark:divide-gray-600">
${units.map(unit => `
<tr class="hover:bg-gray-50 dark:hover:bg-gray-600">
<td class="px-6 py-4">
<div class="flex items-center">
<img src="${unit.images[0]}" alt="${unit.name}" class="w-12 h-12 rounded-lg object-cover ml-4">
<div class="text-sm font-medium text-adaptive">${unit.name}</div>
</div>
</td>
<td class="px-6 py-4 text-sm text-adaptive">${unit.type}</td>
<td class="px-6 py-4 text-sm text-adaptive">${unit.location}</td>
<td class="px-6 py-4 text-sm text-adaptive">${getUnitAveragePrice(unit)} ر.ع</td>
<td class="px-6 py-4 text-sm font-medium">
<div class="flex space-x-2 space-x-reverse">
<button onclick="editUnit(${unit.id})" class="text-oman-blue hover:text-oman-light">تعديل</button>
<button onclick="deleteUnit(${unit.id})" class="text-red-600 hover:text-red-900">حذف</button>
</div>
</td>
</tr>
`).join('')}
</tbody>
</table>
</div>
`;
}

// محتوى الرسائل
function getAdminMessagesContent() {
return `
<div class="mb-6">
<h2 class="text-xl font-bold text-adaptive">الرسائل الواردة</h2>
</div>

${messages.length === 0 ? `
<div class="text-center py-12">
<div class="text-6xl mb-4">📬</div>
<h3 class="text-xl font-bold text-adaptive mb-2">لا توجد رسائل</h3>
<p class="text-adaptive-secondary">ستظهر الرسائل الجديدة هنا</p>
</div>
` : `
<div class="space-y-4">
${messages.map(message => `
<div class="bg-white dark:bg-gray-700 rounded-lg shadow p-6">
<div class="flex justify-between items-start mb-4">
<div>
<h3 class="text-lg font-bold text-adaptive">${message.name}</h3>
<p class="text-sm text-adaptive-secondary">📞 ${message.phone}</p>
<p class="text-sm text-adaptive-secondary">🏠 ${message.unitName}</p>
</div>
<div class="text-sm text-adaptive-secondary">
${new Date(message.timestamp).toLocaleDateString('ar-SA')}
</div>
</div>
<div class="bg-gray-50 dark:bg-gray-600 rounded-lg p-4 mb-4">
<p class="text-adaptive">${message.message}</p>
</div>
<div class="flex space-x-4 space-x-reverse">
<a href="tel:${message.phone}" class="text-oman-blue hover:text-oman-light">اتصال</a>
<a href="https://wa.me/${message.phone}" target="_blank" class="text-green-600 hover:text-green-700">واتساب</a>
</div>
</div>
`).join('')}
</div>
`}
`;
}

// محتوى إعدادات الموقع
function getAdminSettingsContent() {
return `
<div class="mb-6">
<h2 class="text-xl font-bold text-adaptive">إعدادات الموقع</h2>
<p class="text-adaptive-secondary">تحديث معلومات الشركة</p>
</div>

<form onsubmit="handleSaveSettings(event)" class="space-y-6">
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">اسم الشركة</label>
<input type="text" value="${siteSettings.companyName}" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">العنوان</label>
<input type="text" value="${siteSettings.address}" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">رقم الهاتف</label>
<input type="tel" value="${siteSettings.phone}" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">رقم واتساب</label>
<input type="tel" value="${siteSettings.whatsapp}" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div class="md:col-span-2">
<label class="block text-sm font-medium text-adaptive-secondary mb-2">البريد الإلكتروني</label>
<input type="email" value="${siteSettings.email}" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">وصف الشركة</label>
<textarea required rows="4" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">${siteSettings.description}</textarea>
</div>

<div class="flex space-x-4 space-x-reverse">
<button type="submit" class="bg-oman-blue hover:bg-oman-light text-white px-6 py-3 rounded-lg font-medium transition-all">
حفظ الإعدادات
</button>
</div>
</form>
`;
}

// حفظ إعدادات الموقع
function handleSaveSettings(event) {
event.preventDefault();
const form = event.target;
const elements = form.elements;

siteSettings = {
companyName: elements[0].value,
address: elements[1].value,
phone: elements[2].value,
whatsapp: elements[3].value,
email: elements[4].value,
description: elements[5].value
};

saveToStorage('siteSettings', siteSettings);
updateFooter();
showNotification('تم حفظ الإعدادات بنجاح!', 'success');
}

// عرض نموذج إضافة وحدة
function showAddUnitForm() {
currentImages = [];
currentAvailability = {};
generateDateRange().forEach(dateStr => {
currentAvailability[dateStr] = { available: true, price: 50 };
});

const content = document.getElementById('admin-content');
content.innerHTML = `
<div class="mb-6">
<div class="flex items-center space-x-4 space-x-reverse">
<button onclick="showAdminTab('units')" class="text-adaptive-secondary hover:text-adaptive">← العودة</button>
<h2 class="text-xl font-bold text-adaptive">إضافة وحدة جديدة</h2>
</div>
</div>

<form onsubmit="handleSaveUnit(event)" class="space-y-6">
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">اسم الوحدة</label>
<input type="text" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">النوع</label>
<select required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
<option value="">اختر النوع</option>
<option value="شقة">شقة</option>
<option value="غرفة">غرفة</option>
<option value="فيلا">فيلا</option>
<option value="بيت">بيت</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">الموقع</label>
<select required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
<option value="">اختر الموقع</option>
<option value="صلالة الجديدة">صلالة الجديدة</option>
<option value="صلالة الوسطى">صلالة الوسطى</option>
<option value="صلالة الغربية">صلالة الغربية</option>
<option value="عوقد">عوقد</option>
<option value="السعادة">السعادة</option>
<option value="صحنوت">صحلنوت</option>
<option value="ريسوت">ريسوت</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">رقم واتساب</label>
<input type="tel" placeholder="+968xxxxxxxx" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">رقم الهاتف</label>
<input type="tel" placeholder="+968xxxxxxxx" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">الوصف</label>
<textarea required rows="4" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base"></textarea>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">الصور (حتى ${APP_CONFIG.MAX_IMAGES} صور، 5 ميجابايت لكل صورة)</label>
<div class="file-upload-area" onclick="document.getElementById('imageInput').click()">
<div class="text-4xl mb-2">📷</div>
<div class="text-adaptive font-medium">اضغط لاختيار الصور</div>
<div class="text-adaptive-secondary text-sm">أو اسحب الصور هنا</div>
</div>
<input type="file" id="imageInput" multiple accept="image/*" onchange="handleImageSelection(this.files)" class="hidden">
<div id="image-preview-container" class="mt-4"></div>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">جدولة الأسعار والتوفر (يونيو - سبتمبر)</label>
<div class="calendar-slider">
${generateAvailabilityAdmin()}
</div>
</div>

<div class="flex space-x-4 space-x-reverse">
<button type="submit" class="bg-accent hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium transition-all">
حفظ الوحدة
</button>
<button type="button" onclick="showAdminTab('units')" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-all">
إلغاء
</button>
</div>
</form>
`;
}

// حفظ الوحدة
function handleSaveUnit(event) {
event.preventDefault();
const form = event.target;
const elements = form.elements;

if (currentImages.length === 0) {
showNotification('يرجى إضافة صورة واحدة على الأقل', 'error');
return;
}

const newUnit = {
id: Date.now(),
name: elements[0].value,
type: elements[1].value,
location: elements[2].value,
description: elements[5].value,
contact: {
whatsapp: elements[3].value,
phone: elements[4].value
},
images: [...currentImages],
availability: { ...currentAvailability }
};

units.push(newUnit);
saveToStorage('units', units);
loadUnits();
showNotification('تم إضافة الوحدة بنجاح!', 'success');
showAdminTab('units');
}

// تعديل الوحدة
function editUnit(unitId) {
const unit = units.find(u => u.id === unitId);
if (!unit) return;

currentImages = [...unit.images];
currentAvailability = { ...unit.availability };

const content = document.getElementById('admin-content');
content.innerHTML = `
<div class="mb-6">
<div class="flex items-center space-x-4 space-x-reverse">
<button onclick="showAdminTab('units')" class="text-adaptive-secondary hover:text-adaptive">← العودة</button>
<h2 class="text-xl font-bold text-adaptive">تعديل الوحدة</h2>
</div>
</div>

<form onsubmit="handleUpdateUnit(event, ${unitId})" class="space-y-6">
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">اسم الوحدة</label>
<input type="text" value="${unit.name}" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">النوع</label>
<select required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
<option value="شقة" ${unit.type === 'شقة' ? 'selected' : ''}>شقة</option>
<option value="غرفة" ${unit.type === 'غرفة' ? 'selected' : ''}>غرفة</option>
<option value="فيلا" ${unit.type === 'فيلا' ? 'selected' : ''}>فيلا</option>
<option value="بيت" ${unit.type === 'بيت' ? 'selected' : ''}>بيت</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">الموقع</label>
<select required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
<option value="صلالة الجديدة" ${unit.location === 'صلالة الجديدة' ? 'selected' : ''}>صلالة الجديدة</option>
<option value="صلالة الوسطى" ${unit.location === 'صلالة الوسطى' ? 'selected' : ''}>صلالة الوسطى</option>
<option value="صلالة الغربية" ${unit.location === 'صلالة الغربية' ? 'selected' : ''}>صلالة الغربية</option>
<option value="عوقد" ${unit.location === 'عوقد' ? 'selected' : ''}>عوقد</option>
<option value="السعادة" ${unit.location === 'السعادة' ? 'selected' : ''}>السعادة</option>
<option value="صحنوت" ${unit.location === 'صحلنوت' ? 'selected' : ''}>صحنلوت</option>
<option value="ريسوت" ${unit.location === 'ريسوت' ? 'selected' : ''}>ريسوت</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">رقم واتساب</label>
<input type="tel" value="${unit.contact.whatsapp}" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">رقم الهاتف</label>
<input type="tel" value="${unit.contact.phone}" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">الوصف</label>
<textarea required rows="4" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">${unit.description}</textarea>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">الصور</label>
<div class="file-upload-area" onclick="document.getElementById('imageInput').click()">
<div class="text-4xl mb-2">📷</div>
<div class="text-adaptive font-medium">اضغط لتغيير الصور</div>
</div>
<input type="file" id="imageInput" multiple accept="image/*" onchange="handleImageSelection(this.files)" class="hidden">
<div id="image-preview-container" class="mt-4"></div>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">جدولة الأسعار والتوفر</label>
<div class="calendar-slider">
${generateAvailabilityAdmin()}
</div>
</div>

<div class="flex space-x-4 space-x-reverse">
<button type="submit" class="bg-oman-blue hover:bg-oman-light text-white px-6 py-3 rounded-lg font-medium transition-all">
تحديث الوحدة
</button>
<button type="button" onclick="showAdminTab('units')" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-all">
إلغاء
</button>
</div>
</form>
`;

setTimeout(updateImagePreview, 100);
}

// تحديث الوحدة
function handleUpdateUnit(event, unitId) {
event.preventDefault();
const form = event.target;
const elements = form.elements;

if (currentImages.length === 0) {
showNotification('يرجى إضافة صورة واحدة على الأقل', 'error');
return;
}

const unitIndex = units.findIndex(u => u.id === unitId);
if (unitIndex === -1) return;

units[unitIndex] = {
...units[unitIndex],
name: elements[0].value,
type: elements[1].value,
location: elements[2].value,
description: elements[5].value,
contact: {
whatsapp: elements[3].value,
phone: elements[4].value
},
images: [...currentImages],
availability: { ...currentAvailability }
};

saveToStorage('units', units);
loadUnits();
showNotification('تم تحديث الوحدة بنجاح!', 'success');
showAdminTab('units');
}

// حذف الوحدة
function deleteUnit(unitId) {
if (!confirm('هل أنت متأكد من حذف هذه الوحدة؟')) return;

units = units.filter(u => u.id !== unitId);
saveToStorage('units', units);
loadUnits();
showNotification('تم حذف الوحدة بنجاح!', 'success');
showAdminTab('units');
}

// إغلاق لوحة الإدارة
function closeAdminPanel() {
document.getElementById('adminPanel').classList.add('hidden');
currentUser = null;
}

// عرض الإشعارات
function showNotification(message, type = 'info') {
const notification = document.createElement('div');
const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';

notification.className = `fixed top-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50 p-4 rounded-lg shadow-lg ${bgColor} text-white`;
notification.innerHTML = `
<div class="flex justify-between items-center">
<span>${message}</span>
<button onclick="this.parentElement.parentElement.remove()" class="text-white hover:text-gray-200 text-xl">×</button>
</div>
`;

document.body.appendChild(notification);
setTimeout(() => notification.remove(), 5000);
}

// تهيئة التطبيق عند تحميل الصفحة
document.addEventListener('DOMContentLoaded', initApp);
</script>
</body>
</html>
